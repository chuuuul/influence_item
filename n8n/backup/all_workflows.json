[{"createdAt":"2025-06-25T00:00:00.000Z","updatedAt":"2025-06-25T00:00:00.000Z","id":"Nrcjz3Tkn3ga2xAy","name":"Master Automation Pipeline v2 - PRD Complete Implementation with Slack Integration","active":false,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 7 * * *"}]}},"id":"daily-master-cron","name":"Daily Master Cron (7 AM)","type":"n8n-nodes-base.cron","typeVersion":1,"position":[300,300]},{"parameters":{"jsCode":"// ë§ˆìŠ¤í„° íŒŒì´í”„ë¼ì¸ ì´ˆê¸°í™” ë° ì‹œì‘ ì•Œë¦¼\nconst pipelineStart = {\n  session_id: `master_${Date.now()}`,\n  start_time: new Date().toISOString(),\n  prd_version: '1.0',\n  pipeline_type: 'complete_automation',\n  steps_completed: [],\n  \n  // PRD ìš”êµ¬ì‚¬í•­ ì¶”ì \n  prd_requirements: {\n    '5.2_orchestration': 'n8nì„ ì§€íœ˜ìë¡œ ì‚¬ìš©í•˜ì—¬ 24/7 ìë™í™”',\n    '5.2_pipeline': 'ë§¤ì¼ 7ì‹œ Cron â†’ Sheets â†’ RSS â†’ ë¶„ì„ â†’ Slack',\n    '3.1_ai_pipeline': 'AI 2-Pass íŒŒì´í”„ë¼ì¸ ì™„ì „ êµ¬í˜„'\n  }\n};\n\nconsole.log('ğŸš€ PRD ë§ˆìŠ¤í„° ìë™í™” íŒŒì´í”„ë¼ì¸ ì‹œì‘:', pipelineStart.session_id);\n\nreturn [{ json: pipelineStart }];"},"id":"initialize-master-pipeline","name":"Initialize Master Pipeline","type":"n8n-nodes-base.code","typeVersion":2,"position":[500,300]},{"parameters":{"method":"POST","url":"{{ $env.RSS_AUTOMATION_API_URL || 'http://localhost:5002' }}/notifications/pipeline-start","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"session_id","value":"={{ $json.session_id }}"},{"name":"channels_count","value":"0"}]},"options":{"timeout":10000}},"id":"notify-pipeline-start","name":"Notify Pipeline Start","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[700,300]},{"parameters":{"authentication":"serviceAccount","resource":"sheet","operation":"read","documentId":{"__rl":true,"value":"{{ $env.GOOGLE_SHEETS_SPREADSHEET_ID }}","mode":"id"},"sheetName":{"__rl":true,"value":"Channel List","mode":"name"},"options":{"range":"A:E"}},"id":"step1-read-channels","name":"Step 1: Read Channel List","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[900,300]},{"parameters":{"jsCode":"// ì±„ë„ ëª©ë¡ ì²˜ë¦¬ ë° RSS URL ìƒì„±\nconst channelData = $input.all();\nconst masterData = $('Initialize Master Pipeline').item.json;\nconst activeChannels = [];\n\nfor (const row of channelData) {\n  const channelId = row.json.channel_id;\n  const channelName = row.json.channel_name;\n  const status = row.json.status;\n  const channelType = row.json.channel_type;\n  const celebrityName = row.json.celebrity_name;\n  \n  if (status === 'active' && channelId) {\n    activeChannels.push({\n      channel_id: channelId,\n      channel_name: channelName,\n      channel_type: channelType,\n      celebrity_name: celebrityName,\n      rss_url: `https://www.youtube.com/feeds/videos.xml?channel_id=${channelId}`\n    });\n  }\n}\n\nconst result = {\n  ...masterData,\n  steps_completed: ['sheets_read'],\n  active_channels: activeChannels,\n  channels_count: activeChannels.length,\n  next_step: 'rss_collection'\n};\n\nconsole.log(`ğŸ“‹ í™œì„± ì±„ë„ ${activeChannels.length}ê°œ ë¡œë“œ ì™„ë£Œ`);\n\nreturn [{ json: result }];"},"id":"process-channels","name":"Process Channel Data","type":"n8n-nodes-base.code","typeVersion":2,"position":[1100,300]},{"parameters":{"method":"POST","url":"{{ $env.RSS_AUTOMATION_API_URL || 'http://localhost:5002' }}/collect-rss","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"channels","value":"={{ JSON.stringify($json.active_channels) }}"},{"name":"session_id","value":"={{ $json.session_id }}"},{"name":"exclude_shorts","value":"true"},{"name":"days_back","value":"1"}]},"options":{"timeout":60000}},"id":"step2-rss-collection","name":"Step 2: RSS Feed Collection","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1300,300]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"has-new-videos","leftValue":"={{ $json.new_videos && $json.new_videos.length }}","rightValue":"0","operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"id":"check-new-videos","name":"Check If New Videos Found","type":"n8n-nodes-base.if","typeVersion":2,"position":[1500,300]},{"parameters":{"method":"POST","url":"{{ $env.CHANNEL_DISCOVERY_API_URL || 'http://localhost:5001' }}/analyze/batch","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"videos","value":"={{ JSON.stringify($json.new_videos) }}"},{"name":"session_id","value":"={{ $('Process Channel Data').item.json.session_id }}"},{"name":"analysis_type","value":"full_pipeline"},{"name":"prd_compliant","value":"true"}]},"options":{"timeout":600000}},"id":"step3-ai-analysis","name":"Step 3: AI 2-Pass Analysis Pipeline","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1700,200]},{"parameters":{"jsCode":"// ë¶„ì„ ê²°ê³¼ ì²˜ë¦¬ ë° í†µê³„ ìƒì„±\nconst analysisResult = $json;\nconst masterData = $('Process Channel Data').item.json;\n\nconst processedResult = {\n  ...masterData,\n  steps_completed: [...masterData.steps_completed, 'rss_collection', 'ai_analysis'],\n  analysis_result: analysisResult,\n  \n  // í†µê³„ ì •ë³´\n  statistics: {\n    videos_analyzed: analysisResult.total_videos || 0,\n    products_found: analysisResult.total_products || 0,\n    monetizable_products: analysisResult.monetizable_products || 0,\n    ppl_filtered: analysisResult.ppl_filtered || 0,\n    avg_score: analysisResult.average_score || 0\n  },\n  \n  // PRD íŒŒì´í”„ë¼ì¸ ì™„ë£Œ ìƒíƒœ\n  pipeline_status: {\n    whisper_analysis: 'completed',\n    gemini_first_pass: 'completed',\n    visual_analysis: 'completed',\n    gemini_second_pass: 'completed',\n    ppl_filtering: 'completed',\n    monetization_check: 'completed',\n    scoring: 'completed'\n  },\n  \n  next_step: 'notification'\n};\n\nconsole.log(`ğŸ¤– AI ë¶„ì„ ì™„ë£Œ: ${processedResult.statistics.products_found}ê°œ ì œí’ˆ, ${processedResult.statistics.monetizable_products}ê°œ ìˆ˜ìµí™” ê°€ëŠ¥`);\n\nreturn [{ json: processedResult }];"},"id":"process-analysis-results","name":"Process Analysis Results","type":"n8n-nodes-base.code","typeVersion":2,"position":[1900,200]},{"parameters":{"method":"POST","url":"{{ $env.RSS_AUTOMATION_API_URL || 'http://localhost:5002' }}/notifications/pipeline-success","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"session_id","value":"={{ $json.session_id }}"},{"name":"statistics","value":"={{ JSON.stringify($json.statistics) }}"},{"name":"execution_time","value":"={{ ((new Date() - new Date($json.start_time)) / 1000 / 60) }}"},{"name":"channels_count","value":"={{ $json.channels_count }}"}]},"options":{"timeout":10000}},"id":"step4-final-notification","name":"Step 4: Final Success Notification","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2100,200]},{"parameters":{"method":"POST","url":"{{ $env.RSS_AUTOMATION_API_URL || 'http://localhost:5002' }}/notifications/no-videos","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"session_id","value":"={{ $('Process Channel Data').item.json.session_id }}"},{"name":"channels_count","value":"={{ $('Process Channel Data').item.json.channels_count }}"}]},"options":{"timeout":10000}},"id":"no-videos-notification","name":"No New Videos Notification","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1700,400]},{"parameters":{"jsCode":"// ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬ ì‹œë„\nconst error = $input.all()[0];\nconst masterData = $('Process Channel Data').item.json;\n\nconst errorData = {\n  session_id: masterData.session_id,\n  error_time: new Date().toISOString(),\n  error_step: 'pipeline_execution',\n  error_message: error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜',\n  error_details: JSON.stringify(error, null, 2),\n  execution_time: ((new Date() - new Date(masterData.start_time)) / 1000).toFixed(1),\n  recovery_attempted: false\n};\n\nconsole.error('ë§ˆìŠ¤í„° íŒŒì´í”„ë¼ì¸ ì˜¤ë¥˜:', errorData);\n\nreturn [{ json: errorData }];"},"id":"handle-pipeline-error","name":"Handle Pipeline Error","type":"n8n-nodes-base.code","typeVersion":2,"position":[1100,500]},{"parameters":{"method":"POST","url":"{{ $env.RSS_AUTOMATION_API_URL || 'http://localhost:5002' }}/notifications/pipeline-error","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"session_id","value":"={{ $json.session_id }}"},{"name":"error_message","value":"={{ $json.error_message }}"},{"name":"error_step","value":"={{ $json.error_step }}"}]},"options":{"timeout":10000}},"id":"error-notification","name":"Send Error Notification","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1300,500]}],"connections":{"Daily Master Cron (7 AM)":{"main":[[{"node":"Initialize Master Pipeline","type":"main","index":0}]]},"Initialize Master Pipeline":{"main":[[{"node":"Notify Pipeline Start","type":"main","index":0}]]},"Notify Pipeline Start":{"main":[[{"node":"Step 1: Read Channel List","type":"main","index":0}]]},"Step 1: Read Channel List":{"main":[[{"node":"Process Channel Data","type":"main","index":0}]],"error":[[{"node":"Handle Pipeline Error","type":"main","index":0}]]},"Process Channel Data":{"main":[[{"node":"Step 2: RSS Feed Collection","type":"main","index":0}]]},"Step 2: RSS Feed Collection":{"main":[[{"node":"Check If New Videos Found","type":"main","index":0}]],"error":[[{"node":"Handle Pipeline Error","type":"main","index":0}]]},"Check If New Videos Found":{"main":[[{"node":"Step 3: AI 2-Pass Analysis Pipeline","type":"main","index":0}],[{"node":"No New Videos Notification","type":"main","index":0}]]},"Step 3: AI 2-Pass Analysis Pipeline":{"main":[[{"node":"Process Analysis Results","type":"main","index":0}]],"error":[[{"node":"Handle Pipeline Error","type":"main","index":0}]]},"Process Analysis Results":{"main":[[{"node":"Step 4: Final Success Notification","type":"main","index":0}]]},"Handle Pipeline Error":{"main":[[{"node":"Send Error Notification","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","saveManualExecutions":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":{"id":"error-master-workflow"}},"staticData":{},"meta":{"templateCredsSetupCompleted":true,"prd_compliant":true,"version":"2.0","slack_integration":true},"pinData":null,"versionId":null,"triggerCount":0,"tags":[]},{"createdAt":"2025-06-25T07:00:00.000Z","updatedAt":"2025-06-25T07:00:00.000Z","id":"snkDyckbqBpzPt8a","name":"01. Daily RSS Feed Collection","active":false,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 7 * * *"}]}},"id":"daily-cron-7am","name":"Daily Cron (7 AM)","type":"n8n-nodes-base.cron","typeVersion":1,"position":[300,300]},{"parameters":{"authentication":"serviceAccount","resource":"sheet","operation":"read","documentId":{"__rl":true,"value":"{{ $env.GOOGLE_SHEETS_SPREADSHEET_ID }}","mode":"id"},"sheetName":{"__rl":true,"value":"Channel List","mode":"name"},"options":{"range":"A:E"}},"id":"read-channel-list","name":"Read Channel List from Google Sheets","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[500,300]},{"parameters":{"jsCode":"// ì±„ë„ ëª©ë¡ì—ì„œ RSS í”¼ë“œ URL ìƒì„± ë° í•„í„°ë§\nconst channelData = $input.all();\nconst rssUrls = [];\n\nfor (const row of channelData) {\n  const channelId = row.json.channel_id;\n  const channelName = row.json.channel_name;\n  const channelType = row.json.channel_type;\n  const status = row.json.status;\n  const celebrityName = row.json.celebrity_name;\n  \n  // í™œì„± ìƒíƒœì¸ ì±„ë„ë§Œ ì²˜ë¦¬\n  if (status === 'active' && channelId) {\n    rssUrls.push({\n      channel_id: channelId,\n      channel_name: channelName,\n      channel_type: channelType,\n      celebrity_name: celebrityName,\n      rss_url: `https://www.youtube.com/feeds/videos.xml?channel_id=${channelId}`\n    });\n  }\n}\n\nconsole.log(`í™œì„± ì±„ë„ ${rssUrls.length}ê°œì˜ RSS í”¼ë“œ ì¤€ë¹„ ì™„ë£Œ`);\n\nreturn rssUrls.map(url => ({ json: url }));"},"id":"prepare-rss-urls","name":"Prepare RSS Feed URLs","type":"n8n-nodes-base.code","typeVersion":2,"position":[700,300]},{"parameters":{"url":"={{ $json.rss_url }}","options":{"timeout":10000}},"id":"fetch-rss-feed","name":"Fetch RSS Feed","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[900,300]},{"parameters":{"jsCode":"// RSS XML íŒŒì‹±í•˜ì—¬ ìµœì‹  ì˜ìƒ ì¶”ì¶œ\nconst rssXml = $json.body;\nconst channelInfo = $('Prepare RSS Feed URLs').item.json;\nconst DOMParser = require('xmldom').DOMParser;\n\n// XML íŒŒì‹±\nlet newVideos = [];\ntry {\n  const parser = new DOMParser();\n  const xmlDoc = parser.parseFromString(rssXml, 'text/xml');\n  const entries = xmlDoc.getElementsByTagName('entry');\n  \n  // ì§€ë‚œ 24ì‹œê°„ ë‚´ ì—…ë¡œë“œëœ ì˜ìƒë§Œ í•„í„°ë§\n  const yesterday = new Date();\n  yesterday.setDate(yesterday.getDate() - 1);\n  \n  for (let i = 0; i < Math.min(entries.length, 10); i++) {\n    const entry = entries[i];\n    const videoId = entry.getElementsByTagName('yt:videoId')[0]?.textContent;\n    const title = entry.getElementsByTagName('title')[0]?.textContent;\n    const published = entry.getElementsByTagName('published')[0]?.textContent;\n    const author = entry.getElementsByTagName('author')[0]?.getElementsByTagName('name')[0]?.textContent;\n    \n    if (videoId && title && published) {\n      const publishDate = new Date(published);\n      \n      // 24ì‹œê°„ ë‚´ ì—…ë¡œë“œëœ ì˜ìƒì¸ì§€ í™•ì¸\n      if (publishDate >= yesterday) {\n        // ë¯¸ë””ì–´ ì±„ë„ì˜ ê²½ìš° ì—°ì˜ˆì¸ ì´ë¦„ì´ ì œëª©ì— í¬í•¨ëœ ê²½ìš°ë§Œ\n        let shouldInclude = true;\n        if (channelInfo.channel_type === 'media' && channelInfo.celebrity_name) {\n          shouldInclude = title.toLowerCase().includes(channelInfo.celebrity_name.toLowerCase());\n        }\n        \n        // YouTube Shorts ì œì™¸ (PRD ìš”êµ¬ì‚¬í•­)\n        const isShorts = title.toLowerCase().includes('#shorts') || \n                        title.toLowerCase().includes('shorts') ||\n                        title.includes('ğŸ©³');\n        \n        if (shouldInclude && !isShorts) {\n          newVideos.push({\n            video_id: videoId,\n            video_title: title,\n            video_url: `https://www.youtube.com/watch?v=${videoId}`,\n            channel_id: channelInfo.channel_id,\n            channel_name: channelInfo.channel_name,\n            channel_type: channelInfo.channel_type,\n            celebrity_name: channelInfo.celebrity_name,\n            published_date: published,\n            author: author,\n            discovery_date: new Date().toISOString()\n          });\n        }\n      }\n    }\n  }\n} catch (error) {\n  console.error('RSS íŒŒì‹± ì˜¤ë¥˜:', error);\n}\n\nconsole.log(`${channelInfo.channel_name}: ${newVideos.length}ê°œ ì‹ ê·œ ì˜ìƒ ë°œê²¬`);\n\nreturn newVideos.map(video => ({ json: video }));"},"id":"parse-rss-feed","name":"Parse RSS Feed for New Videos","type":"n8n-nodes-base.code","typeVersion":2,"position":[1100,300]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"has-new-videos","leftValue":"={{ $json.video_id }}","rightValue":"","operator":{"type":"string","operation":"isNotEmpty"}}],"combinator":"and"},"options":{}},"id":"check-new-videos","name":"Check If New Videos Found","type":"n8n-nodes-base.if","typeVersion":2,"position":[1300,300]},{"parameters":{"method":"POST","url":"{{ $env.CHANNEL_DISCOVERY_API_URL || 'http://localhost:5001' }}/analyze/video","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"video_url","value":"={{ $json.video_url }}"},{"name":"video_id","value":"={{ $json.video_id }}"},{"name":"channel_info","value":"={{ JSON.stringify({channel_id: $json.channel_id, channel_name: $json.channel_name, channel_type: $json.channel_type, celebrity_name: $json.celebrity_name}) }}"},{"name":"priority","value":"normal"}]},"options":{"timeout":120000}},"id":"trigger-video-analysis","name":"Trigger Video Analysis","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1500,200]},{"parameters":{"method":"POST","url":"{{ $env.SLACK_WEBHOOK_URL }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"text","value":"ğŸ“º ìƒˆë¡œìš´ ì˜ìƒ ë°œê²¬!"},{"name":"blocks","value":"={{ JSON.stringify([{\"type\": \"header\", \"text\": {\"type\": \"plain_text\", \"text\": \"ğŸ“º ìƒˆë¡œìš´ ì˜ìƒ ë°œê²¬!\"}}, {\"type\": \"section\", \"fields\": [{\"type\": \"mrkdwn\", \"text\": \"*ì±„ë„:*\\n\" + $json.channel_name}, {\"type\": \"mrkdwn\", \"text\": \"*ì—°ì˜ˆì¸:*\\n\" + ($json.celebrity_name || 'N/A')}, {\"type\": \"mrkdwn\", \"text\": \"*ì˜ìƒ ì œëª©:*\\n\" + $json.video_title}, {\"type\": \"mrkdwn\", \"text\": \"*ì—…ë¡œë“œ:*\\n\" + new Date($json.published_date).toLocaleString('ko-KR')}]}, {\"type\": \"section\", \"text\": {\"type\": \"mrkdwn\", \"text\": \"ğŸ”— <\" + $json.video_url + \"|ì˜ìƒ ë³´ê¸°> | ğŸ¤– ë¶„ì„ ì‹œì‘ë¨\"}}, {\"type\": \"context\", \"elements\": [{\"type\": \"mrkdwn\", \"text\": \"ğŸ“… \" + new Date().toLocaleString('ko-KR') + \" | ğŸ¤– ìë™ ìˆ˜ì§‘\"}]}]) }}"}]},"options":{"timeout":10000}},"id":"notify-new-video","name":"Notify New Video Found","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1500,400]},{"parameters":{"method":"POST","url":"{{ $env.SLACK_WEBHOOK_URL }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"text","value":"âœ… ì¼ì¼ RSS ìˆ˜ì§‘ ì™„ë£Œ - ìƒˆë¡œìš´ ì˜ìƒ ì—†ìŒ"},{"name":"blocks","value":"={{ JSON.stringify([{\"type\": \"header\", \"text\": {\"type\": \"plain_text\", \"text\": \"âœ… ì¼ì¼ RSS ìˆ˜ì§‘ ì™„ë£Œ\"}}, {\"type\": \"section\", \"text\": {\"type\": \"mrkdwn\", \"text\": \"ğŸ“Š *ê²°ê³¼:* ìƒˆë¡œìš´ ì˜ìƒì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\\n\\nğŸ’¡ *ì°¸ê³ :* ì§€ë‚œ 24ì‹œê°„ ë‚´ ì—…ë¡œë“œëœ ì˜ìƒì´ ì—†ê±°ë‚˜, ì´ë¯¸ ë¶„ì„ ì™„ë£Œëœ ì˜ìƒë“¤ì…ë‹ˆë‹¤.\"}}, {\"type\": \"context\", \"elements\": [{\"type\": \"mrkdwn\", \"text\": \"ğŸ“… \" + new Date().toLocaleString('ko-KR') + \" | ğŸ¤– ìë™ ìˆ˜ì§‘\"}]}]) }}"}]},"options":{"timeout":10000}},"id":"notify-no-videos","name":"Notify No New Videos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1300,500]}],"connections":{"Daily Cron (7 AM)":{"main":[[{"node":"Read Channel List from Google Sheets","type":"main","index":0}]]},"Read Channel List from Google Sheets":{"main":[[{"node":"Prepare RSS Feed URLs","type":"main","index":0}]]},"Prepare RSS Feed URLs":{"main":[[{"node":"Fetch RSS Feed","type":"main","index":0}]]},"Fetch RSS Feed":{"main":[[{"node":"Parse RSS Feed for New Videos","type":"main","index":0}]]},"Parse RSS Feed for New Videos":{"main":[[{"node":"Check If New Videos Found","type":"main","index":0}]]},"Check If New Videos Found":{"main":[[{"node":"Trigger Video Analysis","type":"main","index":0},{"node":"Notify New Video Found","type":"main","index":0}],[{"node":"Notify No New Videos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","saveManualExecutions":true,"callerPolicy":"workflowsFromSameOwner"},"staticData":{},"meta":null,"pinData":null,"versionId":null,"triggerCount":0,"tags":[]},{"createdAt":"2025-06-25T07:00:00.000Z","updatedAt":"2025-06-25T07:00:00.000Z","id":"7meFTag7LXBKDugU","name":"02. Channel Discovery","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"trigger-channel-discovery","options":{"noResponseBody":false}},"id":"manual-trigger","name":"Manual Channel Discovery Trigger","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[300,300],"webhookId":"channel-discovery-trigger"},{"parameters":{"jsCode":"// ì±„ë„ íƒìƒ‰ íŒŒë¼ë¯¸í„° ì„¤ì •\nconst triggerData = $input.all()[0].json;\n\n// ê¸°ë³¸ ì„¤ì •\nconst discoveryParams = {\n  keywords: triggerData.keywords || [\"ì•„ì´ìœ \", \"ë·°í‹°\", \"íŒ¨ì…˜\", \"ë©”ì´í¬ì—…\", \"ìŠ¤í‚¨ì¼€ì–´\"],\n  days_back: triggerData.days_back || 7,\n  max_candidates: triggerData.max_candidates || 50,\n  min_score: triggerData.min_score || 40,\n  search_period: triggerData.search_period || \"week\",\n  channel_types: triggerData.channel_types || [\"personal\", \"media\"],\n  session_id: `discovery_${Date.now()}`,\n  start_time: new Date().toISOString()\n};\n\nconsole.log('ì±„ë„ íƒìƒ‰ ì‹œì‘:', discoveryParams);\n\nreturn [{ json: discoveryParams }];"},"id":"setup-discovery-params","name":"Setup Discovery Parameters","type":"n8n-nodes-base.code","typeVersion":2,"position":[500,300]},{"parameters":{"method":"POST","url":"{{ $env.CHANNEL_DISCOVERY_API_URL || 'http://localhost:5001' }}/discover","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"keywords","value":"={{ JSON.stringify($json.keywords) }}"},{"name":"days_back","value":"={{ $json.days_back }}"},{"name":"max_candidates","value":"={{ $json.max_candidates }}"},{"name":"min_score","value":"={{ $json.min_score }}"},{"name":"search_period","value":"={{ $json.search_period }}"},{"name":"channel_types","value":"={{ JSON.stringify($json.channel_types) }}"}]},"options":{"timeout":300000}},"id":"run-channel-discovery","name":"Run Channel Discovery","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[700,300]},{"parameters":{"jsCode":"// ì±„ë„ íƒìƒ‰ ê²°ê³¼ ì²˜ë¦¬\nconst discoveryResult = $json;\nconst setupData = $('Setup Discovery Parameters').item.json;\n\n// ê²°ê³¼ í†µê³„ ê³„ì‚°\nconst candidates = discoveryResult.candidates || [];\nconst totalCandidates = candidates.length;\nconst highScoreCandidates = candidates.filter(c => c.total_score >= 70).length;\nconst verifiedCandidates = candidates.filter(c => c.verified).length;\n\n// Google Sheets ì €ì¥ìš© ë°ì´í„° ì¤€ë¹„\nconst sheetsData = [];\nconst currentTime = new Date().toISOString().replace('T', ' ').substring(0, 19);\n\nfor (const candidate of candidates) {\n  sheetsData.push({\n    discovery_date: currentTime,\n    session_id: setupData.session_id,\n    channel_name: candidate.channel_name || '',\n    channel_id: candidate.channel_id || '',\n    channel_handle: candidate.channel_handle || '',\n    subscriber_count: candidate.subscriber_count || 0,\n    video_count: candidate.video_count || 0,\n    total_score: (candidate.total_score || 0).toFixed(2),\n    matching_score: (candidate.matching_score || 0).toFixed(2),\n    quality_score: (candidate.quality_score || 0).toFixed(2),\n    potential_score: (candidate.potential_score || 0).toFixed(2),\n    verified: candidate.verified ? \"âœ“\" : \"âœ—\",\n    country: candidate.country || '',\n    channel_type: candidate.channel_type || '',\n    description: (candidate.description || '').substring(0, 100) + (candidate.description && candidate.description.length > 100 ? '...' : ''),\n    channel_url: candidate.channel_url || '',\n    status: 'needs_review'\n  });\n}\n\n// ê²°ê³¼ ë°ì´í„° êµ¬ì„±\nconst processedResult = {\n  session_id: setupData.session_id,\n  start_time: setupData.start_time,\n  end_time: new Date().toISOString(),\n  execution_time: discoveryResult.execution_time_seconds || 0,\n  total_candidates: totalCandidates,\n  high_score_candidates: highScoreCandidates,\n  verified_candidates: verifiedCandidates,\n  candidates: candidates,\n  sheets_data: sheetsData,\n  success: discoveryResult.success || false,\n  session_stats: discoveryResult.session_stats || {},\n  search_params: setupData\n};\n\nconsole.log(`ì±„ë„ íƒìƒ‰ ì™„ë£Œ: ${totalCandidates}ê°œ í›„ë³´ ë°œê²¬`);\n\nreturn [{ json: processedResult }];"},"id":"process-discovery-results","name":"Process Discovery Results","type":"n8n-nodes-base.code","typeVersion":2,"position":[900,300]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"has-candidates","leftValue":"={{ $json.total_candidates }}","rightValue":"0","operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"id":"check-discovery-results","name":"Check If Candidates Found","type":"n8n-nodes-base.if","typeVersion":2,"position":[1100,300]},{"parameters":{"jsCode":"// Google Sheetsìš© ë°ì´í„° ë³€í™˜\nconst result = $json;\nconst sheetsData = result.sheets_data || [];\n\nconsole.log(`Google Sheets ì €ì¥ìš© ë°ì´í„° ì¤€ë¹„: ${sheetsData.length}ê°œ í–‰`);\n\nreturn sheetsData.map(data => ({ json: data }));"},"id":"format-for-sheets","name":"Format Data for Google Sheets","type":"n8n-nodes-base.code","typeVersion":2,"position":[1300,200]},{"parameters":{"authentication":"serviceAccount","resource":"sheet","operation":"append","documentId":{"__rl":true,"value":"{{ $env.GOOGLE_SHEETS_SPREADSHEET_ID }}","mode":"id"},"sheetName":{"__rl":true,"value":"Channel Discovery Results","mode":"name"},"columnNames":"A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q","options":{"useAppend":true}},"id":"save-to-sheets","name":"Save Results to Google Sheets","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[1500,200]},{"parameters":{"method":"POST","url":"{{ $env.SLACK_WEBHOOK_URL }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"text","value":"ğŸ¯ ì±„ë„ íƒìƒ‰ ì™„ë£Œ! {{ $json.total_candidates }}ê°œ í›„ë³´ ë°œê²¬"},{"name":"blocks","value":"={{ JSON.stringify([{\"type\": \"header\", \"text\": {\"type\": \"plain_text\", \"text\": \"ğŸ¯ ì±„ë„ íƒìƒ‰ ì™„ë£Œ!\"}}, {\"type\": \"section\", \"fields\": [{\"type\": \"mrkdwn\", \"text\": \"*ë°œê²¬ëœ í›„ë³´:*\\n\" + $json.total_candidates + \"ê°œ\"}, {\"type\": \"mrkdwn\", \"text\": \"*ê³ ë“ì  í›„ë³´:*\\n\" + $json.high_score_candidates + \"ê°œ\"}, {\"type\": \"mrkdwn\", \"text\": \"*ì¸ì¦ ì±„ë„:*\\n\" + $json.verified_candidates + \"ê°œ\"}, {\"type\": \"mrkdwn\", \"text\": \"*ì‹¤í–‰ ì‹œê°„:*\\n\" + $json.execution_time.toFixed(1) + \"ì´ˆ\"}]}, {\"type\": \"section\", \"text\": {\"type\": \"mrkdwn\", \"text\": \"ğŸ† *ìƒìœ„ í›„ë³´ë“¤:*\\n\" + $json.candidates.slice(0, 5).map((c, i) => `${i+1}. <${c.channel_url}|${c.channel_name}> (${c.total_score.toFixed(1)}ì , ${c.subscriber_count.toLocaleString()}ëª…) ${c.verified ? 'âœ“' : 'âœ—'}`).join('\\n')}}, {\"type\": \"divider\"}, {\"type\": \"section\", \"text\": {\"type\": \"mrkdwn\", \"text\": \"ğŸ“‹ <https://docs.google.com/spreadsheets/d/\" + $env.GOOGLE_SHEETS_SPREADSHEET_ID + \"|Google Sheetsì—ì„œ ì „ì²´ ê²°ê³¼ í™•ì¸>\"}}, {\"type\": \"context\", \"elements\": [{\"type\": \"mrkdwn\", \"text\": \"ì™„ë£Œ ì‹œê°„: \" + new Date().toLocaleString('ko-KR') + \" | ì„¸ì…˜: \" + $json.session_id}]}]) }}"}]},"options":{"timeout":10000}},"id":"notify-success","name":"Notify Discovery Success","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1700,200]},{"parameters":{"method":"POST","url":"{{ $env.SLACK_WEBHOOK_URL }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"text","value":"ğŸ˜” ì±„ë„ íƒìƒ‰ ì™„ë£Œ - ìƒˆë¡œìš´ í›„ë³´ ì—†ìŒ"},{"name":"blocks","value":"={{ JSON.stringify([{\"type\": \"header\", \"text\": {\"type\": \"plain_text\", \"text\": \"ğŸ˜” ì±„ë„ íƒìƒ‰ ì™„ë£Œ\"}}, {\"type\": \"section\", \"text\": {\"type\": \"mrkdwn\", \"text\": \"*ê²°ê³¼:* ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ìƒˆë¡œìš´ ì±„ë„ í›„ë³´ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\\n\\n*ì‹¤í–‰ ì‹œê°„:* \" + $json.execution_time.toFixed(1) + \"ì´ˆ\\n*ì„¸ì…˜ ID:* \" + $json.session_id}}, {\"type\": \"section\", \"text\": {\"type\": \"mrkdwn\", \"text\": \"ğŸ’¡ *ì œì•ˆ:*\\nâ€¢ ê²€ìƒ‰ í‚¤ì›Œë“œ ì¡°ì •\\nâ€¢ ì ìˆ˜ ê¸°ì¤€ ë‚®ì¶”ê¸°\\nâ€¢ ê²€ìƒ‰ ê¸°ê°„ ëŠ˜ë¦¬ê¸°\"}}, {\"type\": \"context\", \"elements\": [{\"type\": \"mrkdwn\", \"text\": \"ì™„ë£Œ ì‹œê°„: \" + new Date().toLocaleString('ko-KR') + \" | ì‹œìŠ¤í…œ: n8n ìë™í™”\"}]}]) }}"}]},"options":{"timeout":10000}},"id":"notify-no-results","name":"Notify No Results","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1300,400]}],"connections":{"Manual Channel Discovery Trigger":{"main":[[{"node":"Setup Discovery Parameters","type":"main","index":0}]]},"Setup Discovery Parameters":{"main":[[{"node":"Run Channel Discovery","type":"main","index":0}]]},"Run Channel Discovery":{"main":[[{"node":"Process Discovery Results","type":"main","index":0}]]},"Process Discovery Results":{"main":[[{"node":"Check If Candidates Found","type":"main","index":0}]]},"Check If Candidates Found":{"main":[[{"node":"Format Data for Google Sheets","type":"main","index":0}],[{"node":"Notify No Results","type":"main","index":0}]]},"Format Data for Google Sheets":{"main":[[{"node":"Save Results to Google Sheets","type":"main","index":0}]]},"Save Results to Google Sheets":{"main":[[{"node":"Notify Discovery Success","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","saveManualExecutions":true,"callerPolicy":"workflowsFromSameOwner"},"staticData":{},"meta":null,"pinData":null,"versionId":null,"triggerCount":0,"tags":[]},{"createdAt":"2025-06-25T07:00:00.000Z","updatedAt":"2025-06-25T07:00:00.000Z","id":"4et0ZLlLbeBo9gp5","name":"03. AI Analysis Pipeline","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"trigger-ai-analysis","options":{"noResponseBody":false}},"id":"analysis-trigger","name":"AI Analysis Trigger","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[300,300],"webhookId":"ai-analysis-trigger"},{"parameters":{"jsCode":"// AI ë¶„ì„ íŒŒë¼ë¯¸í„° ì„¤ì • ë° ê²€ì¦\nconst triggerData = $input.all()[0].json;\n\n// í•„ìˆ˜ íŒŒë¼ë¯¸í„° ê²€ì¦\nif (!triggerData.video_url) {\n  throw new Error('video_url is required');\n}\n\n// ë¶„ì„ ì„¤ì •\nconst analysisParams = {\n  video_url: triggerData.video_url,\n  video_id: triggerData.video_id || extractVideoId(triggerData.video_url),\n  channel_info: triggerData.channel_info || {},\n  priority: triggerData.priority || 'normal',\n  analysis_type: triggerData.analysis_type || 'full', // full, quick, audio_only\n  session_id: `analysis_${Date.now()}`,\n  start_time: new Date().toISOString(),\n  \n  // AI 2-Pass íŒŒì´í”„ë¼ì¸ ì„¤ì •\n  whisper_model: 'small', // PRD ìš”êµ¬ì‚¬í•­: Whisper small ëª¨ë¸\n  gemini_model: '2.5-flash', // PRD ìš”êµ¬ì‚¬í•­: Gemini 2.5 Flash\n  enable_ocr: true,\n  enable_object_detection: true,\n  enable_ppl_detection: true,\n  enable_monetization_check: true,\n  \n  // ì ìˆ˜ ê°€ì¤‘ì¹˜ (PRD ê³µì‹)\n  scoring_weights: {\n    sentiment_score: 0.50,\n    endorsement_score: 0.35,\n    influencer_score: 0.15\n  }\n};\n\n// ë¹„ë””ì˜¤ ID ì¶”ì¶œ í•¨ìˆ˜\nfunction extractVideoId(url) {\n  const match = url.match(/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([a-zA-Z0-9_-]+)/);\n  return match ? match[1] : null;\n}\n\nconsole.log('AI ë¶„ì„ ì‹œì‘:', analysisParams);\n\nreturn [{ json: analysisParams }];"},"id":"setup-analysis-params","name":"Setup Analysis Parameters","type":"n8n-nodes-base.code","typeVersion":2,"position":[500,300]},{"parameters":{"method":"POST","url":"{{ $env.CHANNEL_DISCOVERY_API_URL || 'http://localhost:5001' }}/analyze/whisper","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"video_url","value":"={{ $json.video_url }}"},{"name":"video_id","value":"={{ $json.video_id }}"},{"name":"model","value":"{{ $json.whisper_model }}"},{"name":"session_id","value":"={{ $json.session_id }}"}]},"options":{"timeout":300000}},"id":"step1-whisper-analysis","name":"Step 1: Whisper Audio Analysis","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[700,300]},{"parameters":{"method":"POST","url":"{{ $env.CHANNEL_DISCOVERY_API_URL || 'http://localhost:5001' }}/analyze/gemini-first-pass","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"transcript","value":"={{ JSON.stringify($json.transcript) }}"},{"name":"video_id","value":"={{ $('Setup Analysis Parameters').item.json.video_id }}"},{"name":"session_id","value":"={{ $('Setup Analysis Parameters').item.json.session_id }}"},{"name":"model","value":"{{ $('Setup Analysis Parameters').item.json.gemini_model }}"}]},"options":{"timeout":120000}},"id":"step2-gemini-first-pass","name":"Step 2: Gemini First Pass (íƒìƒ‰)","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[900,300]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"has-candidate-segments","leftValue":"={{ $json.candidate_segments && $json.candidate_segments.length }}","rightValue":"0","operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"id":"check-candidate-segments","name":"Check If Candidate Segments Found","type":"n8n-nodes-base.if","typeVersion":2,"position":[1100,300]},{"parameters":{"method":"POST","url":"{{ $env.CHANNEL_DISCOVERY_API_URL || 'http://localhost:5001' }}/analyze/visual","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"video_url","value":"={{ $('Setup Analysis Parameters').item.json.video_url }}"},{"name":"candidate_segments","value":"={{ JSON.stringify($json.candidate_segments) }}"},{"name":"session_id","value":"={{ $('Setup Analysis Parameters').item.json.session_id }}"},{"name":"enable_ocr","value":"{{ $('Setup Analysis Parameters').item.json.enable_ocr }}"},{"name":"enable_object_detection","value":"{{ $('Setup Analysis Parameters').item.json.enable_object_detection }}"}]},"options":{"timeout":300000}},"id":"step3-visual-analysis","name":"Step 3: Visual Analysis (OCR + Object Detection)","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1300,200]},{"parameters":{"method":"POST","url":"{{ $env.CHANNEL_DISCOVERY_API_URL || 'http://localhost:5001' }}/analyze/gemini-second-pass","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"audio_data","value":"={{ JSON.stringify($('Step 2: Gemini First Pass (íƒìƒ‰)').item.json) }}"},{"name":"visual_data","value":"={{ JSON.stringify($json) }}"},{"name":"video_id","value":"={{ $('Setup Analysis Parameters').item.json.video_id }}"},{"name":"session_id","value":"={{ $('Setup Analysis Parameters').item.json.session_id }}"},{"name":"channel_info","value":"={{ JSON.stringify($('Setup Analysis Parameters').item.json.channel_info) }}"}]},"options":{"timeout":120000}},"id":"step4-gemini-second-pass","name":"Step 4: Gemini Second Pass (ì¢…í•©)","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1500,200]},{"parameters":{"method":"POST","url":"{{ $env.CHANNEL_DISCOVERY_API_URL || 'http://localhost:5001' }}/analyze/ppl-filter","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"analysis_result","value":"={{ JSON.stringify($json) }}"},{"name":"session_id","value":"={{ $('Setup Analysis Parameters').item.json.session_id }}"}]},"options":{"timeout":60000}},"id":"step5-ppl-filtering","name":"Step 5: PPL Content Filtering","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1700,200]},{"parameters":{"method":"POST","url":"{{ $env.CHANNEL_DISCOVERY_API_URL || 'http://localhost:5001' }}/analyze/monetization","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"products","value":"={{ JSON.stringify($json.products || []) }}"},{"name":"session_id","value":"={{ $('Setup Analysis Parameters').item.json.session_id }}"}]},"options":{"timeout":60000}},"id":"step6-monetization-check","name":"Step 6: Monetization Verification (Coupang)","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1900,200]},{"parameters":{"method":"POST","url":"{{ $env.CHANNEL_DISCOVERY_API_URL || 'http://localhost:5001' }}/analyze/scoring","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"analysis_data","value":"={{ JSON.stringify($json) }}"},{"name":"scoring_weights","value":"={{ JSON.stringify($('Setup Analysis Parameters').item.json.scoring_weights) }}"},{"name":"session_id","value":"={{ $('Setup Analysis Parameters').item.json.session_id }}"}]},"options":{"timeout":60000}},"id":"step7-scoring","name":"Step 7: Attractiveness Scoring","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2100,200]},{"parameters":{"jsCode":"// ìµœì¢… ë¶„ì„ ê²°ê³¼ ì²˜ë¦¬ ë° ì •ë¦¬\nconst finalResult = $json;\nconst setupData = $('Setup Analysis Parameters').item.json;\n\n// ë¶„ì„ ì™„ë£Œ ë°ì´í„° êµ¬ì„±\nconst processedResult = {\n  session_id: setupData.session_id,\n  video_url: setupData.video_url,\n  video_id: setupData.video_id,\n  channel_info: setupData.channel_info,\n  start_time: setupData.start_time,\n  end_time: new Date().toISOString(),\n  execution_time: ((new Date() - new Date(setupData.start_time)) / 1000).toFixed(1),\n  \n  // ë¶„ì„ ê²°ê³¼\n  analysis_result: finalResult,\n  total_products: finalResult.products ? finalResult.products.length : 0,\n  monetizable_products: finalResult.monetizable_products ? finalResult.monetizable_products.length : 0,\n  filtered_products: finalResult.filtered_products ? finalResult.filtered_products.length : 0,\n  \n  // ìƒíƒœ ì •ë³´\n  status: 'analysis_complete',\n  success: true,\n  \n  // íƒ€ì„ìŠ¤íƒ¬í”„\n  completed_at: new Date().toISOString()\n};\n\nconsole.log(`AI ë¶„ì„ ì™„ë£Œ: ${processedResult.total_products}ê°œ ì œí’ˆ ë°œê²¬, ${processedResult.monetizable_products}ê°œ ìˆ˜ìµí™” ê°€ëŠ¥`);\n\nreturn [{ json: processedResult }];"},"id":"finalize-analysis","name":"Finalize Analysis Results","type":"n8n-nodes-base.code","typeVersion":2,"position":[2300,200]},{"parameters":{"method":"POST","url":"{{ $env.SLACK_WEBHOOK_URL }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"text","value":"ğŸ¤– AI ë¶„ì„ ì™„ë£Œ!"},{"name":"blocks","value":"={{ JSON.stringify([{\"type\": \"header\", \"text\": {\"type\": \"plain_text\", \"text\": \"ğŸ¤– AI ë¶„ì„ ì™„ë£Œ!\"}}, {\"type\": \"section\", \"fields\": [{\"type\": \"mrkdwn\", \"text\": \"*ì˜ìƒ:*\\n<\" + $json.video_url + \"|\" + ($json.channel_info.channel_name || 'Unknown') + \">\"}, {\"type\": \"mrkdwn\", \"text\": \"*ë°œê²¬ëœ ì œí’ˆ:*\\n\" + $json.total_products + \"ê°œ\"}, {\"type\": \"mrkdwn\", \"text\": \"*ìˆ˜ìµí™” ê°€ëŠ¥:*\\n\" + $json.monetizable_products + \"ê°œ\"}, {\"type\": \"mrkdwn\", \"text\": \"*ì‹¤í–‰ ì‹œê°„:*\\n\" + $json.execution_time + \"ì´ˆ\"}]}, {\"type\": \"section\", \"text\": {\"type\": \"mrkdwn\", \"text\": \"ğŸ“Š *ë¶„ì„ íŒŒì´í”„ë¼ì¸:*\\nâœ… Whisper ìŒì„± ë¶„ì„\\nâœ… Gemini 1ì°¨ íƒìƒ‰\\nâœ… ì‹œê° ë¶„ì„ (OCR + Object)\\nâœ… Gemini 2ì°¨ ì¢…í•©\\nâœ… PPL í•„í„°ë§\\nâœ… ì¿ íŒ¡ ìˆ˜ìµí™” ê²€ì¦\\nâœ… ë§¤ë ¥ë„ ìŠ¤ì½”ì–´ë§\"}}, {\"type\": \"context\", \"elements\": [{\"type\": \"mrkdwn\", \"text\": \"ì™„ë£Œ: \" + new Date().toLocaleString('ko-KR') + \" | ì„¸ì…˜: \" + $json.session_id}]}]) }}"}]},"options":{"timeout":10000}},"id":"notify-analysis-complete","name":"Notify Analysis Complete","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[2500,200]},{"parameters":{"method":"POST","url":"{{ $env.SLACK_WEBHOOK_URL }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"text","value":"ğŸ˜” AI ë¶„ì„ ì™„ë£Œ - ì œí’ˆ í›„ë³´ ì—†ìŒ"},{"name":"blocks","value":"={{ JSON.stringify([{\"type\": \"header\", \"text\": {\"type\": \"plain_text\", \"text\": \"ğŸ˜” AI ë¶„ì„ ì™„ë£Œ\"}}, {\"type\": \"section\", \"text\": {\"type\": \"mrkdwn\", \"text\": \"*ê²°ê³¼:* ì œí’ˆ ì¶”ì²œ êµ¬ê°„ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\\n\\n*ë¶„ì„ëœ ì˜ìƒ:*\\n<\" + $('Setup Analysis Parameters').item.json.video_url + \"|\" + ($('Setup Analysis Parameters').item.json.channel_info.channel_name || 'Unknown') + \">\\n\\n*ì„¸ì…˜ ID:* \" + $('Setup Analysis Parameters').item.json.session_id}}, {\"type\": \"section\", \"text\": {\"type\": \"mrkdwn\", \"text\": \"ğŸ’¡ *ê°€ëŠ¥í•œ ì›ì¸:*\\nâ€¢ ì œí’ˆ ì–¸ê¸‰ì´ ì—†ëŠ” ì˜ìƒ\\nâ€¢ ì¶”ì²œ ë§¥ë½ì´ ëª…í™•í•˜ì§€ ì•ŠìŒ\\nâ€¢ ìŒì„± ì¸ì‹ í’ˆì§ˆ ë¬¸ì œ\"}}, {\"type\": \"context\", \"elements\": [{\"type\": \"mrkdwn\", \"text\": \"ì™„ë£Œ: \" + new Date().toLocaleString('ko-KR') + \" | ì‹œìŠ¤í…œ: AI ë¶„ì„ íŒŒì´í”„ë¼ì¸\"}]}]) }}"}]},"options":{"timeout":10000}},"id":"notify-no-products","name":"Notify No Products Found","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1300,400]}],"connections":{"AI Analysis Trigger":{"main":[[{"node":"Setup Analysis Parameters","type":"main","index":0}]]},"Setup Analysis Parameters":{"main":[[{"node":"Step 1: Whisper Audio Analysis","type":"main","index":0}]]},"Step 1: Whisper Audio Analysis":{"main":[[{"node":"Step 2: Gemini First Pass (íƒìƒ‰)","type":"main","index":0}]]},"Step 2: Gemini First Pass (íƒìƒ‰)":{"main":[[{"node":"Check If Candidate Segments Found","type":"main","index":0}]]},"Check If Candidate Segments Found":{"main":[[{"node":"Step 3: Visual Analysis (OCR + Object Detection)","type":"main","index":0}],[{"node":"Notify No Products Found","type":"main","index":0}]]},"Step 3: Visual Analysis (OCR + Object Detection)":{"main":[[{"node":"Step 4: Gemini Second Pass (ì¢…í•©)","type":"main","index":0}]]},"Step 4: Gemini Second Pass (ì¢…í•©)":{"main":[[{"node":"Step 5: PPL Content Filtering","type":"main","index":0}]]},"Step 5: PPL Content Filtering":{"main":[[{"node":"Step 6: Monetization Verification (Coupang)","type":"main","index":0}]]},"Step 6: Monetization Verification (Coupang)":{"main":[[{"node":"Step 7: Attractiveness Scoring","type":"main","index":0}]]},"Step 7: Attractiveness Scoring":{"main":[[{"node":"Finalize Analysis Results","type":"main","index":0}]]},"Finalize Analysis Results":{"main":[[{"node":"Notify Analysis Complete","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","saveManualExecutions":true,"callerPolicy":"workflowsFromSameOwner"},"staticData":{},"meta":null,"pinData":null,"versionId":null,"triggerCount":0,"tags":[]},{"createdAt":"2025-06-23T21:48:00.000Z","updatedAt":"2025-06-23T21:48:00.000Z","id":"1LXzZtFFbkpnDqdi","name":"Google Sheets Real-time Sync Workflow","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"sheets-webhook","options":{"noResponseBody":false}},"id":"sheets-webhook","name":"Google Sheets Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[300,300],"webhookId":"google-sheets-changes"},{"parameters":{"jsCode":"// Google Sheets Webhook ë°ì´í„° íŒŒì‹±\nconst webhookData = $json;\n\nconsole.log('Google Sheets ë³€ê²½ì‚¬í•­ ê°ì§€:', webhookData);\n\n// Webhook ë°ì´í„° êµ¬ì¡° íŒŒì‹±\nconst changeData = {\n  eventType: webhookData.eventType || 'unknown',\n  spreadsheetId: webhookData.spreadsheetId,\n  sheetId: webhookData.sheetId,\n  range: webhookData.range,\n  changeType: webhookData.changeType || 'edit',\n  timestamp: new Date().toISOString(),\n  rawData: webhookData\n};\n\n// ì±„ë„ ëª©ë¡ ì‹œíŠ¸ ë³€ê²½ì¸ì§€ í™•ì¸\nconst isChannelListChange = changeData.spreadsheetId === $env.GOOGLE_SHEETS_CHANNEL_LIST_ID;\n\nreturn [{\n  json: {\n    ...changeData,\n    isChannelListChange: isChannelListChange,\n    needsSync: isChannelListChange\n  }\n}];"},"id":"parse-webhook-data","name":"Parse Webhook Data","type":"n8n-nodes-base.code","typeVersion":2,"position":[500,300]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"is-channel-list","leftValue":"={{ $json.isChannelListChange }}","rightValue":"true","operator":{"type":"boolean","operation":"equal"}}],"combinator":"and"},"options":{}},"id":"check-channel-list","name":"Check Channel List Change","type":"n8n-nodes-base.if","typeVersion":2,"position":[700,300]},{"parameters":{"authentication":"serviceAccount","resource":"sheet","operation":"read","documentId":{"__rl":true,"value":"{{$env.GOOGLE_SHEETS_CHANNEL_LIST_ID}}","mode":"id"},"sheetName":{"__rl":true,"value":"ì±„ë„ëª©ë¡","mode":"name"},"options":{"range":"A:D","valueRenderMode":"FORMATTED_VALUE"}},"id":"read-updated-channels","name":"Read Updated Channel List","type":"n8n-nodes-base.googleSheets","typeVersion":4,"position":[900,200]},{"parameters":{"jsCode":"// ì—…ë°ì´íŠ¸ëœ ì±„ë„ ëª©ë¡ ì²˜ë¦¬ ë° ë³€ê²½ì‚¬í•­ íƒì§€\nconst channels = [];\nconst inputData = $input.all();\nconst webhookData = $('Parse Webhook Data').item.json;\n\n// í˜„ì¬ ì‹œê°„\nconst syncTime = new Date().toISOString();\n\n// ì²« ë²ˆì§¸ í–‰ì€ í—¤ë”ì´ë¯€ë¡œ ì œì™¸\nfor (let i = 1; i < inputData.length; i++) {\n  const row = inputData[i].json;\n  \n  // ì±„ë„ëª…, RSS URL, íƒ€ì…, ì—°ì˜ˆì¸ ì´ë¦„ ì¶”ì¶œ\n  if (row.A && row.B) { // ì±„ë„ëª…ê³¼ RSS URLì´ ìˆëŠ” ê²½ìš°ë§Œ\n    channels.push({\n      channelName: row.A,\n      rssUrl: row.B,\n      channelType: row.C || 'personal',\n      celebrityNames: row.D ? row.D.split(',').map(name => name.trim()) : [],\n      lastUpdated: syncTime\n    });\n  }\n}\n\nconsole.log(`ì±„ë„ ëª©ë¡ ë™ê¸°í™”: ${channels.length}ê°œ ì±„ë„ ì—…ë°ì´íŠ¸ë¨`);\n\n// ë™ê¸°í™” ê²°ê³¼ ë°ì´í„° êµ¬ì„±\nconst syncResult = {\n  syncTime: syncTime,\n  totalChannels: channels.length,\n  changeEvent: webhookData,\n  channels: channels,\n  syncStatus: 'completed'\n};\n\nreturn [{ json: syncResult }];"},"id":"process-channel-sync","name":"Process Channel Sync","type":"n8n-nodes-base.code","typeVersion":2,"position":[1100,200]},{"parameters":{"method":"POST","url":"{{ $env.PYTHON_ANALYSIS_ENDPOINT }}/sync-channels","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Authorization","value":"Bearer {{ $env.ANALYSIS_API_KEY }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"channels","value":"={{ JSON.stringify($json.channels) }}"},{"name":"sync_time","value":"={{ $json.syncTime }}"},{"name":"total_channels","value":"={{ $json.totalChannels }}"}]},"options":{"timeout":15000}},"id":"update-python-channels","name":"Update Python System Channels","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1300,200]},{"parameters":{"channel":"{{ $env.SLACK_CHANNEL }}","text":"ğŸ“‹ ì±„ë„ ëª©ë¡ ìë™ ë™ê¸°í™” ì™„ë£Œ\\n\\nğŸ“Š ë™ê¸°í™” ê²°ê³¼:\\n- ì´ ì±„ë„ ìˆ˜: {{ $json.totalChannels }}ê°œ\\n- ë™ê¸°í™” ì‹œê°„: {{ $json.syncTime }}\\n- ë³€ê²½ ë²”ìœ„: {{ $('Parse Webhook Data').item.json.range }}\\n\\nâœ… Python ì‹œìŠ¤í…œê³¼ ë™ê¸°í™” ì™„ë£Œ","otherOptions":{}},"id":"notify-sync-success","name":"Notify Sync Success","type":"n8n-nodes-base.slack","typeVersion":2.1,"position":[1500,200]},{"parameters":{"jsCode":"// ì±„ë„ ëª©ë¡ ë³€ê²½ì´ ì•„ë‹Œ ê²½ìš° ë¡œê¹…\nconst webhookData = $json;\n\nconsole.log('ë¹„ì±„ë„ ëª©ë¡ ì‹œíŠ¸ ë³€ê²½ì‚¬í•­ ê°ì§€:', webhookData.spreadsheetId);\n\nreturn [{\n  json: {\n    message: 'ì±„ë„ ëª©ë¡ì´ ì•„ë‹Œ ì‹œíŠ¸ ë³€ê²½ì‚¬í•­ ê°ì§€ë¨',\n    spreadsheetId: webhookData.spreadsheetId,\n    action: 'ignored',\n    timestamp: new Date().toISOString()\n  }\n}];"},"id":"log-other-changes","name":"Log Other Sheet Changes","type":"n8n-nodes-base.code","typeVersion":2,"position":[900,400]},{"parameters":{"jsCode":"// ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹…\nconst error = $json;\nconst webhookData = $('Parse Webhook Data').item.json;\n\nconsole.error('ì±„ë„ ë™ê¸°í™” ì‹¤íŒ¨:', error);\n\nreturn [{\n  json: {\n    error: error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜',\n    webhookData: webhookData,\n    errorTime: new Date().toISOString(),\n    status: 'sync_failed'\n  }\n}];"},"id":"handle-sync-error","name":"Handle Sync Error","type":"n8n-nodes-base.code","typeVersion":2,"position":[1300,400]},{"parameters":{"channel":"{{ $env.SLACK_CHANNEL }}","text":"âŒ ì±„ë„ ëª©ë¡ ë™ê¸°í™” ì‹¤íŒ¨\\n\\nğŸ’¥ ì—ëŸ¬ ë‚´ìš©:\\n{{ $json.error }}\\n\\nâ° ë°œìƒ ì‹œê°„: {{ $json.errorTime }}\\n\\nğŸ”§ ìš´ì˜ì í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.","otherOptions":{}},"id":"notify-sync-error","name":"Notify Sync Error","type":"n8n-nodes-base.slack","typeVersion":2.1,"position":[1500,400]}],"connections":{"Google Sheets Webhook":{"main":[[{"node":"Parse Webhook Data","type":"main","index":0}]]},"Parse Webhook Data":{"main":[[{"node":"Check Channel List Change","type":"main","index":0}]]},"Check Channel List Change":{"main":[[{"node":"Read Updated Channel List","type":"main","index":0}],[{"node":"Log Other Sheet Changes","type":"main","index":0}]]},"Read Updated Channel List":{"main":[[{"node":"Process Channel Sync","type":"main","index":0}]]},"Process Channel Sync":{"main":[[{"node":"Update Python System Channels","type":"main","index":0}]]},"Update Python System Channels":{"main":[[{"node":"Notify Sync Success","type":"main","index":0}]],"error":[[{"node":"Handle Sync Error","type":"main","index":0}]]},"Handle Sync Error":{"main":[[{"node":"Notify Sync Error","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","saveManualExecutions":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":{"id":"error-workflow"}},"staticData":{},"meta":null,"pinData":null,"versionId":null,"triggerCount":0,"tags":[]},{"createdAt":"2025-06-23T21:56:00.000Z","updatedAt":"2025-06-23T21:56:00.000Z","id":"DWeYSvD8EqKBBv6U","name":"Notification Priority Routing Workflow","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"notification-router","options":{"noResponseBody":false}},"id":"notification-webhook","name":"Notification Router Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[300,300],"webhookId":"notification-router"},{"parameters":{"jsCode":"// ì•Œë¦¼ ìš°ì„ ìˆœìœ„ ë¶„ë¥˜ ë° ë¼ìš°íŒ… ë¡œì§\nconst notificationData = $json;\n\nconsole.log('ì•Œë¦¼ ë¼ìš°íŒ… ìš”ì²­ ìˆ˜ì‹ :', notificationData.type);\n\n// ì•Œë¦¼ íƒ€ì…ë³„ ìš°ì„ ìˆœìœ„ ì •ì˜\nconst priorityMatrix = {\n  // ì‹œìŠ¤í…œ ì•Œë¦¼\n  'system_error': { priority: 'CRITICAL', channels: ['email', 'slack'], throttle: 0 },\n  'system_warning': { priority: 'HIGH', channels: ['slack'], throttle: 300 }, // 5ë¶„\n  'system_info': { priority: 'MEDIUM', channels: ['slack'], throttle: 1800 }, // 30ë¶„\n  \n  // ë¶„ì„ ì•Œë¦¼\n  'analysis_completed': { priority: 'MEDIUM', channels: ['slack'], throttle: 0 },\n  'analysis_failed': { priority: 'HIGH', channels: ['slack', 'email'], throttle: 0 },\n  'high_score_candidate': { priority: 'HIGH', channels: ['slack'], throttle: 0 },\n  \n  // ì±„ë„ ê´€ë¦¬ ì•Œë¦¼\n  'channel_sync': { priority: 'LOW', channels: ['slack'], throttle: 3600 }, // 1ì‹œê°„\n  'channel_error': { priority: 'MEDIUM', channels: ['slack'], throttle: 600 }, // 10ë¶„\n  \n  // ìˆ˜ìµí™” ì•Œë¦¼\n  'monetization_opportunity': { priority: 'HIGH', channels: ['slack'], throttle: 0 },\n  'coupang_api_error': { priority: 'HIGH', channels: ['slack', 'email'], throttle: 0 },\n  \n  // ì¼ë°˜ ìš´ì˜ ì•Œë¦¼\n  'daily_report': { priority: 'LOW', channels: ['slack', 'email'], throttle: 86400 }, // 24ì‹œê°„\n  'weekly_summary': { priority: 'LOW', channels: ['email'], throttle: 604800 }, // 7ì¼\n  \n  // ì‚¬ìš©ì ì•¡ì…˜ ì•Œë¦¼\n  'user_approval': { priority: 'MEDIUM', channels: ['slack'], throttle: 0 },\n  'user_rejection': { priority: 'LOW', channels: [], throttle: 0 } // ë¡œê·¸ë§Œ\n};\n\n// ê¸°ë³¸ ì„¤ì •\nconst defaultPriority = { priority: 'MEDIUM', channels: ['slack'], throttle: 0 };\n\n// ì•Œë¦¼ íƒ€ì…ì— ë”°ë¥¸ ì„¤ì • ê°€ì ¸ì˜¤ê¸°\nconst notificationType = notificationData.type || 'unknown';\nconst config = priorityMatrix[notificationType] || defaultPriority;\n\n// ë‚´ìš© ê¸°ë°˜ ìš°ì„ ìˆœìœ„ ì¡°ì •\nfunction adjustPriorityByContent(baseConfig, data) {\n  const content = (data.message || data.title || '').toLowerCase();\n  const urgentKeywords = ['critical', 'fatal', 'crash', 'down', 'failure', 'ì¹˜ëª…ì ', 'ì‹¬ê°', 'ì¤‘ë‹¨'];\n  const importantKeywords = ['error', 'warning', 'timeout', 'ì—ëŸ¬', 'ê²½ê³ ', 'ì‹¤íŒ¨'];\n  \n  if (urgentKeywords.some(keyword => content.includes(keyword))) {\n    return {\n      ...baseConfig,\n      priority: 'CRITICAL',\n      channels: ['email', 'slack']\n    };\n  } else if (importantKeywords.some(keyword => content.includes(keyword))) {\n    return {\n      ...baseConfig,\n      priority: baseConfig.priority === 'LOW' ? 'MEDIUM' : baseConfig.priority\n    };\n  }\n  \n  return baseConfig;\n}\n\nconst finalConfig = adjustPriorityByContent(config, notificationData);\n\n// ìŠ¤ë¡œí‹€ë§ ì²´í¬ë¥¼ ìœ„í•œ í‚¤ ìƒì„±\nconst throttleKey = `${notificationType}_${notificationData.component || 'global'}`;\n\n// ì•Œë¦¼ ë©”íƒ€ë°ì´í„° êµ¬ì„±\nconst routingData = {\n  // ì›ë³¸ ë°ì´í„°\n  originalData: notificationData,\n  \n  // ë¼ìš°íŒ… ì •ë³´\n  notificationType: notificationType,\n  priority: finalConfig.priority,\n  channels: finalConfig.channels,\n  throttleKey: throttleKey,\n  throttleSeconds: finalConfig.throttle,\n  \n  // íƒ€ì„ìŠ¤íƒ¬í”„\n  receivedAt: new Date().toISOString(),\n  \n  // ë©”íƒ€ë°ì´í„°\n  metadata: {\n    source: notificationData.source || 'unknown',\n    component: notificationData.component || 'system',\n    environment: notificationData.environment || 'production',\n    userId: notificationData.user_id || null,\n    requestId: notificationData.request_id || null\n  },\n  \n  // ìš°ì„ ìˆœìœ„ë³„ ì²˜ë¦¬ ë°©ì‹\n  processingConfig: {\n    immediate: finalConfig.priority === 'CRITICAL',\n    requiresEmail: finalConfig.channels.includes('email'),\n    requiresSlack: finalConfig.channels.includes('slack'),\n    canThrottle: finalConfig.throttle > 0\n  }\n};\n\nconsole.log(`ì•Œë¦¼ ë¼ìš°íŒ… ì™„ë£Œ: ${notificationType} -> ${finalConfig.priority} (${finalConfig.channels.join(', ')})`);\n\nreturn [{ json: routingData }];"},"id":"classify-notification","name":"Classify Notification Priority","type":"n8n-nodes-base.code","typeVersion":2,"position":[500,300]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"can-throttle","leftValue":"={{ $json.processingConfig.canThrottle }}","rightValue":"true","operator":{"type":"boolean","operation":"equal"}}],"combinator":"and"},"options":{}},"id":"check-throttling","name":"Check Throttling Required","type":"n8n-nodes-base.if","typeVersion":2,"position":[700,300]},{"parameters":{"method":"GET","url":"{{ $env.REDIS_ENDPOINT || $env.PYTHON_ANALYSIS_ENDPOINT }}/throttle/check","sendQuery":true,"queryParameters":{"parameters":[{"name":"key","value":"={{ $json.throttleKey }}"},{"name":"seconds","value":"={{ $json.throttleSeconds }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer {{ $env.ANALYSIS_API_KEY }}"}]},"options":{"timeout":5000}},"id":"check-throttle-status","name":"Check Throttle Status","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[900,200]},{"parameters":{"jsCode":"// ìŠ¤ë¡œí‹€ë§ ìƒíƒœ í™•ì¸ ë° ì²˜ë¦¬ ê²°ì •\nconst routingData = $('Classify Notification Priority').item.json;\nconst throttleResult = $json;\n\nconst shouldProcess = !throttleResult.is_throttled;\n\nif (shouldProcess) {\n  console.log(`ì•Œë¦¼ ì²˜ë¦¬ ì§„í–‰: ${routingData.notificationType}`);\n} else {\n  console.log(`ì•Œë¦¼ ìŠ¤ë¡œí‹€ë§ë¨: ${routingData.notificationType} (ë§ˆì§€ë§‰ ë°œì†¡: ${throttleResult.last_sent})`);\n}\n\nreturn [{\n  json: {\n    ...routingData,\n    shouldProcess: shouldProcess,\n    throttleInfo: throttleResult,\n    decision: shouldProcess ? 'PROCESS' : 'THROTTLED'\n  }\n}];"},"id":"evaluate-throttle","name":"Evaluate Throttle Decision","type":"n8n-nodes-base.code","typeVersion":2,"position":[1100,200]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"should-process","leftValue":"={{ $json.shouldProcess }}","rightValue":"true","operator":{"type":"boolean","operation":"equal"}}],"combinator":"and"},"options":{}},"id":"check-should-process","name":"Check Should Process","type":"n8n-nodes-base.if","typeVersion":2,"position":[1300,200]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"needs-email","leftValue":"={{ $json.processingConfig.requiresEmail }}","rightValue":"true","operator":{"type":"boolean","operation":"equal"}}],"combinator":"and"},"options":{}},"id":"check-email-required","name":"Check Email Required","type":"n8n-nodes-base.if","typeVersion":2,"position":[1500,100]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"needs-slack","leftValue":"={{ $json.processingConfig.requiresSlack }}","rightValue":"true","operator":{"type":"boolean","operation":"equal"}}],"combinator":"and"},"options":{}},"id":"check-slack-required","name":"Check Slack Required","type":"n8n-nodes-base.if","typeVersion":2,"position":[1500,300]},{"parameters":{"method":"POST","url":"{{ $env.N8N_WEBHOOK_BASE_URL }}/webhook/system-error","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"originalData","value":"={{ JSON.stringify($json.originalData) }}"},{"name":"priority","value":"={{ $json.priority }}"},{"name":"routing_source","value":"notification-router"}]},"options":{"timeout":10000}},"id":"trigger-email-workflow","name":"Trigger Email Workflow","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1700,50]},{"parameters":{"method":"POST","url":"{{ $env.N8N_WEBHOOK_BASE_URL }}/webhook/analysis-complete","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"originalData","value":"={{ JSON.stringify($json.originalData) }}"},{"name":"priority","value":"={{ $json.priority }}"},{"name":"routing_source","value":"notification-router"}]},"options":{"timeout":10000}},"id":"trigger-slack-workflow","name":"Trigger Slack Workflow","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1700,250]},{"parameters":{"method":"POST","url":"{{ $env.REDIS_ENDPOINT || $env.PYTHON_ANALYSIS_ENDPOINT }}/throttle/set","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Authorization","value":"Bearer {{ $env.ANALYSIS_API_KEY }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"key","value":"={{ $json.throttleKey }}"},{"name":"seconds","value":"={{ $json.throttleSeconds }}"},{"name":"metadata","value":"={{ JSON.stringify($json.metadata) }}"}]},"options":{"timeout":5000}},"id":"update-throttle-status","name":"Update Throttle Status","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1900,200]},{"parameters":{"jsCode":"// ì¦‰ì‹œ ì²˜ë¦¬ (ìŠ¤ë¡œí‹€ë§ ì—†ìŒ)\nconst routingData = $json;\n\nconsole.log(`ì¦‰ì‹œ ì²˜ë¦¬: ${routingData.notificationType} (ìš°ì„ ìˆœìœ„: ${routingData.priority})`);\n\nreturn [{\n  json: {\n    ...routingData,\n    decision: 'IMMEDIATE_PROCESS',\n    bypassThrottle: true\n  }\n}];"},"id":"immediate-processing","name":"Immediate Processing","type":"n8n-nodes-base.code","typeVersion":2,"position":[900,400]},{"parameters":{"jsCode":"// ìŠ¤ë¡œí‹€ë§ëœ ì•Œë¦¼ ë¡œê¹…\nconst routingData = $json;\n\nconsole.log(`ì•Œë¦¼ ìŠ¤ë¡œí‹€ë§: ${routingData.notificationType} - ${routingData.throttleInfo?.reason || 'ë¹ˆë„ ì œí•œ'}`);\n\nreturn [{\n  json: {\n    notificationType: routingData.notificationType,\n    decision: 'THROTTLED',\n    reason: 'ë¹ˆë„ ì œí•œìœ¼ë¡œ ì¸í•œ ìŠ¤í‚µ',\n    lastSent: routingData.throttleInfo?.last_sent,\n    nextAllowed: routingData.throttleInfo?.next_allowed,\n    timestamp: new Date().toISOString()\n  }\n}];"},"id":"log-throttled-notification","name":"Log Throttled Notification","type":"n8n-nodes-base.code","typeVersion":2,"position":[1500,500]},{"parameters":{"jsCode":"// ì•Œë¦¼ ë¼ìš°íŒ… ì™„ë£Œ ë¡œê¹…\nconst routingData = $('Check Should Process').item.json;\nconst emailResult = $('Trigger Email Workflow').item?.json || null;\nconst slackResult = $('Trigger Slack Workflow').item?.json || null;\n\nconst summary = {\n  notificationType: routingData.notificationType,\n  priority: routingData.priority,\n  channelsTriggered: {\n    email: !!emailResult,\n    slack: !!slackResult\n  },\n  processedAt: new Date().toISOString(),\n  throttleUpdated: true\n};\n\nconsole.log(`ì•Œë¦¼ ë¼ìš°íŒ… ì™„ë£Œ: ${JSON.stringify(summary)}`);\n\nreturn [{ json: summary }];"},"id":"log-routing-completion","name":"Log Routing Completion","type":"n8n-nodes-base.code","typeVersion":2,"position":[2100,200]}],"connections":{"Notification Router Webhook":{"main":[[{"node":"Classify Notification Priority","type":"main","index":0}]]},"Classify Notification Priority":{"main":[[{"node":"Check Throttling Required","type":"main","index":0}]]},"Check Throttling Required":{"main":[[{"node":"Check Throttle Status","type":"main","index":0}],[{"node":"Immediate Processing","type":"main","index":0}]]},"Check Throttle Status":{"main":[[{"node":"Evaluate Throttle Decision","type":"main","index":0}]]},"Evaluate Throttle Decision":{"main":[[{"node":"Check Should Process","type":"main","index":0}]]},"Check Should Process":{"main":[[{"node":"Check Email Required","type":"main","index":0},{"node":"Check Slack Required","type":"main","index":0}],[{"node":"Log Throttled Notification","type":"main","index":0}]]},"Check Email Required":{"main":[[{"node":"Trigger Email Workflow","type":"main","index":0}]]},"Check Slack Required":{"main":[[{"node":"Trigger Slack Workflow","type":"main","index":0}]]},"Trigger Email Workflow":{"main":[[{"node":"Update Throttle Status","type":"main","index":0}]]},"Trigger Slack Workflow":{"main":[[{"node":"Update Throttle Status","type":"main","index":0}]]},"Update Throttle Status":{"main":[[{"node":"Log Routing Completion","type":"main","index":0}]]},"Immediate Processing":{"main":[[{"node":"Check Email Required","type":"main","index":0},{"node":"Check Slack Required","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","saveManualExecutions":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":{"id":"error-workflow"}},"staticData":{},"meta":null,"pinData":null,"versionId":null,"triggerCount":0,"tags":[]}]