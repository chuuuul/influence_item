{
  "name": "Daily Operations Report Workflow",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "cronExpression": "0 21 * * *"
            }
          ]
        }
      },
      "id": "daily-report-trigger",
      "name": "Daily 9PM Report Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        300,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// ì¼ì¼ ë¦¬í¬íŠ¸ ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘\nconst reportDate = new Date();\nconst yesterday = new Date(reportDate - 24 * 60 * 60 * 1000);\n\n// ë¦¬í¬íŠ¸ ê¸°ê°„ ì„¤ì •\nconst reportPeriod = {\n  startDate: yesterday.toISOString().split('T')[0],\n  endDate: reportDate.toISOString().split('T')[0],\n  reportGenerated: reportDate.toISOString()\n};\n\nconsole.log(`ì¼ì¼ ìš´ì˜ ë¦¬í¬íŠ¸ ìƒì„± ì‹œì‘: ${reportPeriod.startDate}`);\n\nreturn [{ json: reportPeriod }];"
      },
      "id": "init-report-period",
      "name": "Initialize Report Period",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        500,
        300
      ]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "{{ $env.PYTHON_ANALYSIS_ENDPOINT }}/stats/daily",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "start_date",
              "value": "={{ $json.startDate }}"
            },
            {
              "name": "end_date",
              "value": "={{ $json.endDate }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{ $env.ANALYSIS_API_KEY }}"
            }
          ]
        },
        "options": {
          "timeout": 30000
        }
      },
      "id": "fetch-daily-stats",
      "name": "Fetch Daily Statistics",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        700,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// ì¼ì¼ í†µê³„ ë°ì´í„° ì²˜ë¦¬ ë° ë¦¬í¬íŠ¸ êµ¬ì„±\nconst reportPeriod = $('Initialize Report Period').item.json;\nconst statsData = $json;\n\n// í†µê³„ ë°ì´í„° íŒŒì‹±\nconst stats = {\n  // ì˜ìƒ ë¶„ì„ í†µê³„\n  totalVideosAnalyzed: statsData.total_videos_analyzed || 0,\n  totalCandidatesFound: statsData.total_candidates_found || 0,\n  totalApprovedCandidates: statsData.total_approved_candidates || 0,\n  totalRejectedCandidates: statsData.total_rejected_candidates || 0,\n  \n  // ì±„ë„ í†µê³„\n  activeChannels: statsData.active_channels || 0,\n  newChannelsAdded: statsData.new_channels_added || 0,\n  \n  // ì„±ëŠ¥ í†µê³„\n  avgProcessingTime: statsData.avg_processing_time_seconds || 0,\n  avgScorePerCandidate: statsData.avg_score_per_candidate || 0,\n  \n  // ì—ëŸ¬ í†µê³„\n  totalErrors: statsData.total_errors || 0,\n  criticalErrors: statsData.critical_errors || 0,\n  \n  // ìˆ˜ìµí™” í†µê³„\n  monetizableCandidates: statsData.monetizable_candidates || 0,\n  coupangProductsFound: statsData.coupang_products_found || 0,\n  \n  // ì‹œìŠ¤í…œ í†µê³„\n  systemUptime: statsData.system_uptime_percentage || 0,\n  apiCallsCount: statsData.api_calls_count || 0,\n  storageUsed: statsData.storage_used_gb || 0\n};\n\n// ë¹„ìœ¨ ê³„ì‚°\nconst approvalRate = stats.totalCandidatesFound > 0 ? \n  (stats.totalApprovedCandidates / stats.totalCandidatesFound * 100).toFixed(1) : 0;\n  \nconst monetizationRate = stats.totalApprovedCandidates > 0 ? \n  (stats.monetizableCandidates / stats.totalApprovedCandidates * 100).toFixed(1) : 0;\n  \nconst errorRate = stats.totalVideosAnalyzed > 0 ? \n  (stats.totalErrors / stats.totalVideosAnalyzed * 100).toFixed(2) : 0;\n\n// ì„±ê³¼ ë“±ê¸‰ ê³„ì‚°\nfunction getPerformanceGrade(approvalRate, errorRate, uptime) {\n  if (approvalRate >= 30 && errorRate <= 5 && uptime >= 99) return 'A+';\n  if (approvalRate >= 20 && errorRate <= 10 && uptime >= 95) return 'A';\n  if (approvalRate >= 15 && errorRate <= 15 && uptime >= 90) return 'B+';\n  if (approvalRate >= 10 && errorRate <= 20 && uptime >= 85) return 'B';\n  return 'C';\n}\n\nconst performanceGrade = getPerformanceGrade(parseFloat(approvalRate), parseFloat(errorRate), stats.systemUptime);\n\n// ì¼ì¼ ë¦¬í¬íŠ¸ ë°ì´í„° êµ¬ì„±\nconst dailyReport = {\n  ...reportPeriod,\n  ...stats,\n  \n  // ê³„ì‚°ëœ ë¹„ìœ¨\n  approvalRate: approvalRate,\n  monetizationRate: monetizationRate,\n  errorRate: errorRate,\n  performanceGrade: performanceGrade,\n  \n  // ìƒíƒœ í‰ê°€\n  isHealthy: parseFloat(errorRate) <= 10 && stats.systemUptime >= 95,\n  needsAttention: parseFloat(errorRate) > 15 || stats.systemUptime < 90 || stats.criticalErrors > 0,\n  \n  // ì¶”ê°€ ë©”íŠ¸ë¦­\n  videosPerChannel: stats.activeChannels > 0 ? (stats.totalVideosAnalyzed / stats.activeChannels).toFixed(1) : 0,\n  candidatesPerVideo: stats.totalVideosAnalyzed > 0 ? (stats.totalCandidatesFound / stats.totalVideosAnalyzed).toFixed(1) : 0\n};\n\nconsole.log(`ì¼ì¼ ë¦¬í¬íŠ¸ ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ: ì„±ê³¼ ë“±ê¸‰ ${performanceGrade}`);\n\nreturn [{ json: dailyReport }];"
      },
      "id": "process-daily-stats",
      "name": "Process Daily Statistics",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        900,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// ì¼ì¼ ë¦¬í¬íŠ¸ Slack ë©”ì‹œì§€ êµ¬ì„±\nconst report = $json;\n\n// ì„±ê³¼ ë“±ê¸‰ë³„ ì´ëª¨ì§€\nconst gradeEmojis = {\n  'A+': 'ğŸ†', 'A': 'ğŸ¥‡', 'B+': 'ğŸ¥ˆ', 'B': 'ğŸ¥‰', 'C': 'ğŸ“Š'\n};\n\n// ìƒíƒœë³„ ì´ëª¨ì§€\nconst statusEmoji = report.isHealthy ? 'ğŸŸ¢' : report.needsAttention ? 'ğŸ”´' : 'ğŸŸ¡';\nconst gradeEmoji = gradeEmojis[report.performanceGrade] || 'ğŸ“Š';\n\n// ì„±ê³¼ ìš”ì•½ í…ìŠ¤íŠ¸\nfunction getPerformanceSummary(grade, approvalRate, errorRate) {\n  if (grade === 'A+' || grade === 'A') {\n    return 'ì‹œìŠ¤í…œì´ ìš°ìˆ˜í•˜ê²Œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤! ğŸ‘';\n  } else if (grade === 'B+' || grade === 'B') {\n    return 'ì–‘í˜¸í•œ ì„±ê³¼ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. ì¼ë¶€ ê°œì„  ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤.';\n  } else {\n    return 'ì‹œìŠ¤í…œ ì„±ëŠ¥ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤. ê²€í† ê°€ í•„ìš”í•©ë‹ˆë‹¤.';\n  }\n}\n\nconst performanceSummary = getPerformanceSummary(report.performanceGrade, report.approvalRate, report.errorRate);\n\n// ì£¼ìš” ì§€í‘œ ë¶„ì„\nlet keyInsights = [];\nif (parseFloat(report.approvalRate) > 25) {\n  keyInsights.push('âœ¨ ë†’ì€ ìŠ¹ì¸ë¥  ë‹¬ì„±!');\n}\nif (parseFloat(report.monetizationRate) > 80) {\n  keyInsights.push('ğŸ’° ìš°ìˆ˜í•œ ìˆ˜ìµí™” ë¹„ìœ¨!');\n}\nif (parseFloat(report.errorRate) < 5) {\n  keyInsights.push('ğŸ›¡ï¸ ì•ˆì •ì ì¸ ì‹œìŠ¤í…œ ìš´ì˜!');\n}\nif (report.totalVideosAnalyzed > 20) {\n  keyInsights.push('ğŸš€ ë†’ì€ ì²˜ë¦¬ëŸ‰ ë‹¬ì„±!');\n}\nif (keyInsights.length === 0) {\n  keyInsights.push('ğŸ“ˆ ì§€ì†ì ì¸ ê°œì„  ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.');\n}\n\n// Slack ë©”ì‹œì§€ êµ¬ì„±\nconst slackMessage = {\n  channel: $env.SLACK_CHANNEL,\n  blocks: [\n    {\n      \"type\": \"header\",\n      \"text\": {\n        \"type\": \"plain_text\",\n        \"text\": `${gradeEmoji} ì¼ì¼ ìš´ì˜ ë¦¬í¬íŠ¸ (${report.startDate})`\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": `${statusEmoji} *ì‹œìŠ¤í…œ ìƒíƒœ:* ${report.isHealthy ? 'ì •ìƒ' : report.needsAttention ? 'ì£¼ì˜ í•„ìš”' : 'ë³´í†µ'}\\n${gradeEmoji} *ì„±ê³¼ ë“±ê¸‰:* ${report.performanceGrade}\\n\\n${performanceSummary}`\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"fields\": [\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*ğŸ“¹ ë¶„ì„ëœ ì˜ìƒ*\\n${report.totalVideosAnalyzed}ê°œ`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*ğŸ¯ ë°œê²¬ëœ í›„ë³´*\\n${report.totalCandidatesFound}ê°œ`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*âœ… ìŠ¹ì¸ë¥ *\\n${report.approvalRate}%`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*ğŸ’° ìˆ˜ìµí™” ë¹„ìœ¨*\\n${report.monetizationRate}%`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*ğŸ“º í™œì„± ì±„ë„*\\n${report.activeChannels}ê°œ`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*âš¡ í‰ê·  ì²˜ë¦¬ ì‹œê°„*\\n${report.avgProcessingTime}ì´ˆ`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*ğŸ›¡ï¸ ì‹œìŠ¤í…œ ê°€ë™ë¥ *\\n${report.systemUptime}%`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*âŒ ì˜¤ë¥˜ìœ¨*\\n${report.errorRate}%`\n        }\n      ]\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": `*ğŸ” ì£¼ìš” ì¸ì‚¬ì´íŠ¸:*\\n${keyInsights.join('\\n')}`\n      }\n    }\n  ],\n  attachments: [\n    {\n      \"color\": report.isHealthy ? \"good\" : report.needsAttention ? \"danger\" : \"warning\",\n      \"fields\": [\n        {\n          \"title\": \"ì„¸ë¶€ ë©”íŠ¸ë¦­\",\n          \"value\": `ìŠ¹ì¸ëœ í›„ë³´: ${report.totalApprovedCandidates}ê°œ\\nê±°ì ˆëœ í›„ë³´: ${report.totalRejectedCandidates}ê°œ\\nì±„ë„ë‹¹ ì˜ìƒ: ${report.videosPerChannel}ê°œ\\nì˜ìƒë‹¹ í›„ë³´: ${report.candidatesPerVideo}ê°œ\\nì´ ì—ëŸ¬: ${report.totalErrors}ê°œ (ì‹¬ê°: ${report.criticalErrors}ê°œ)\\nAPI í˜¸ì¶œ: ${report.apiCallsCount}íšŒ\\nì €ì¥ì†Œ ì‚¬ìš©: ${report.storageUsed}GB`,\n          \"short\": false\n        }\n      ],\n      \"actions\": [\n        {\n          \"type\": \"button\",\n          \"text\": \"ğŸ“Š ëŒ€ì‹œë³´ë“œ ë³´ê¸°\",\n          \"url\": `${$env.DASHBOARD_BASE_URL}/analytics`\n        },\n        {\n          \"type\": \"button\",\n          \"text\": \"ğŸ“ˆ ìƒì„¸ í†µê³„\",\n          \"url\": `${$env.DASHBOARD_BASE_URL}/reports/daily/${report.startDate}`\n        }\n      ]\n    }\n  ]\n};\n\nreturn [{ json: slackMessage }];"
      },
      "id": "format-slack-report",
      "name": "Format Slack Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1100,
        200
      ]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "channel": "={{ $json.channel }}",
        "blocksUi": "={{ JSON.stringify($json.blocks) }}",
        "attachments": "={{ JSON.stringify($json.attachments) }}",
        "otherOptions": {}
      },
      "id": "send-slack-report",
      "name": "Send Slack Report",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [
        1300,
        200
      ]
    },
    {
      "parameters": {
        "jsCode": "// ìƒì„¸ ì´ë©”ì¼ ë¦¬í¬íŠ¸ HTML í…œí”Œë¦¿ ìƒì„±\nconst report = $('Process Daily Statistics').item.json;\n\n// ì„±ê³¼ ë“±ê¸‰ë³„ ìƒ‰ìƒ\nconst gradeColors = {\n  'A+': '#2E7D32', 'A': '#388E3C', 'B+': '#FBC02D', 'B': '#FF8F00', 'C': '#D32F2F'\n};\n\nconst gradeColor = gradeColors[report.performanceGrade] || '#757575';\n\n// ì°¨íŠ¸ ë°ì´í„° (ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ ê¸°ë°˜)\nconst createProgressBar = (value, max, color) => {\n  const percentage = Math.min((value / max) * 100, 100);\n  return `\n    <div style=\"background: #f0f0f0; height: 20px; border-radius: 10px; overflow: hidden; margin: 5px 0;\">\n      <div style=\"background: ${color}; height: 100%; width: ${percentage}%; transition: width 0.3s ease;\"></div>\n    </div>\n    <small style=\"color: #666;\">${value}${max ? ` / ${max}` : ''} (${percentage.toFixed(1)}%)</small>\n  `;\n};\n\n// HTML ì´ë©”ì¼ í…œí”Œë¦¿\nconst htmlTemplate = `\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Daily Operations Report - ${report.startDate}</title>\n</head>\n<body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f5f5f5;\">\n    <!-- Header -->\n    <div style=\"background: linear-gradient(135deg, ${gradeColor}, #1976D2); color: white; padding: 30px; border-radius: 8px; text-align: center; margin-bottom: 20px;\">\n        <h1 style=\"margin: 0; font-size: 28px;\">ğŸ“Š ì¼ì¼ ìš´ì˜ ë¦¬í¬íŠ¸</h1>\n        <p style=\"margin: 10px 0 0 0; font-size: 16px; opacity: 0.9;\">${report.startDate} ë¶„ì„ ê²°ê³¼</p>\n        <div style=\"background: rgba(255,255,255,0.2); display: inline-block; padding: 10px 20px; border-radius: 20px; margin-top: 15px;\">\n            <span style=\"font-size: 24px; font-weight: bold;\">ì„±ê³¼ ë“±ê¸‰: ${report.performanceGrade}</span>\n        </div>\n    </div>\n    \n    <!-- ì‹œìŠ¤í…œ ìƒíƒœ ìš”ì•½ -->\n    <div style=\"background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">\n        <h2 style=\"color: #333; margin-top: 0; border-bottom: 2px solid ${gradeColor}; padding-bottom: 10px;\">ğŸš¦ ì‹œìŠ¤í…œ ìƒíƒœ ìš”ì•½</h2>\n        \n        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;\">\n            <div style=\"text-align: center; padding: 15px; background: ${report.isHealthy ? '#E8F5E8' : '#FFF3E0'}; border-radius: 8px;\">\n                <div style=\"font-size: 24px; margin-bottom: 5px;\">${report.isHealthy ? 'ğŸŸ¢' : 'ğŸŸ¡'}</div>\n                <div style=\"font-weight: bold; color: ${report.isHealthy ? '#2E7D32' : '#FF8F00'};\">ì‹œìŠ¤í…œ ìƒíƒœ</div>\n                <div>${report.isHealthy ? 'ì •ìƒ ìš´ì˜' : 'ì£¼ì˜ í•„ìš”'}</div>\n            </div>\n            <div style=\"text-align: center; padding: 15px; background: #F3E5F5; border-radius: 8px;\">\n                <div style=\"font-size: 24px; margin-bottom: 5px;\">âš¡</div>\n                <div style=\"font-weight: bold; color: #7B1FA2;\">ê°€ë™ë¥ </div>\n                <div>${report.systemUptime}%</div>\n            </div>\n            <div style=\"text-align: center; padding: 15px; background: #E3F2FD; border-radius: 8px;\">\n                <div style=\"font-size: 24px; margin-bottom: 5px;\">ğŸ“Š</div>\n                <div style=\"font-weight: bold; color: #1976D2;\">ì²˜ë¦¬ëŸ‰</div>\n                <div>${report.totalVideosAnalyzed}ê°œ ì˜ìƒ</div>\n            </div>\n            <div style=\"text-align: center; padding: 15px; background: #E8F5E8; border-radius: 8px;\">\n                <div style=\"font-size: 24px; margin-bottom: 5px;\">âœ…</div>\n                <div style=\"font-weight: bold; color: #2E7D32;\">ìŠ¹ì¸ë¥ </div>\n                <div>${report.approvalRate}%</div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- ì£¼ìš” ë©”íŠ¸ë¦­ -->\n    <div style=\"background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">\n        <h2 style=\"color: #333; margin-top: 0; border-bottom: 2px solid ${gradeColor}; padding-bottom: 10px;\">ğŸ“ˆ ì£¼ìš” ì„±ê³¼ ì§€í‘œ</h2>\n        \n        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;\">\n            <div>\n                <h3 style=\"color: #555; margin-bottom: 15px;\">ğŸ¯ ë¶„ì„ ì„±ê³¼</h3>\n                \n                <div style=\"margin-bottom: 20px;\">\n                    <strong>ìŠ¹ì¸ë¥ </strong>\n                    ${createProgressBar(parseFloat(report.approvalRate), 100, '#4CAF50')}\n                </div>\n                \n                <div style=\"margin-bottom: 20px;\">\n                    <strong>ìˆ˜ìµí™” ë¹„ìœ¨</strong>\n                    ${createProgressBar(parseFloat(report.monetizationRate), 100, '#FF9800')}\n                </div>\n                \n                <div style=\"margin-bottom: 20px;\">\n                    <strong>í‰ê·  ì ìˆ˜</strong>\n                    ${createProgressBar(report.avgScorePerCandidate, 100, '#2196F3')}\n                </div>\n            </div>\n            \n            <div>\n                <h3 style=\"color: #555; margin-bottom: 15px;\">ğŸ›¡ï¸ ì‹œìŠ¤í…œ ì•ˆì •ì„±</h3>\n                \n                <div style=\"margin-bottom: 20px;\">\n                    <strong>ê°€ë™ë¥ </strong>\n                    ${createProgressBar(report.systemUptime, 100, '#9C27B0')}\n                </div>\n                \n                <div style=\"margin-bottom: 20px;\">\n                    <strong>ì˜¤ë¥˜ìœ¨ (ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ)</strong>\n                    ${createProgressBar(parseFloat(report.errorRate), 20, report.errorRate <= 5 ? '#4CAF50' : report.errorRate <= 10 ? '#FF9800' : '#F44336')}\n                </div>\n                \n                <div style=\"margin-bottom: 20px;\">\n                    <strong>í‰ê·  ì²˜ë¦¬ ì‹œê°„</strong>\n                    <div style=\"color: #666; margin-top: 5px;\">${report.avgProcessingTime}ì´ˆ</div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- ìƒì„¸ í†µê³„ -->\n    <div style=\"background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">\n        <h2 style=\"color: #333; margin-top: 0; border-bottom: 2px solid ${gradeColor}; padding-bottom: 10px;\">ğŸ“Š ìƒì„¸ í†µê³„</h2>\n        \n        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;\">\n            <div>\n                <h4 style=\"color: #555; margin-bottom: 10px;\">ğŸ“¹ ì˜ìƒ ë¶„ì„</h4>\n                <ul style=\"list-style: none; padding: 0; margin: 0;\">\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">ì´ ë¶„ì„ ì˜ìƒ: <strong>${report.totalVideosAnalyzed}ê°œ</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">ë°œê²¬ëœ í›„ë³´: <strong>${report.totalCandidatesFound}ê°œ</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">ìŠ¹ì¸ëœ í›„ë³´: <strong>${report.totalApprovedCandidates}ê°œ</strong></li>\n                    <li style=\"padding: 5px 0;\">ê±°ì ˆëœ í›„ë³´: <strong>${report.totalRejectedCandidates}ê°œ</strong></li>\n                </ul>\n            </div>\n            \n            <div>\n                <h4 style=\"color: #555; margin-bottom: 10px;\">ğŸ“º ì±„ë„ í˜„í™©</h4>\n                <ul style=\"list-style: none; padding: 0; margin: 0;\">\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">í™œì„± ì±„ë„: <strong>${report.activeChannels}ê°œ</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">ì‹ ê·œ ì±„ë„: <strong>${report.newChannelsAdded}ê°œ</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">ì±„ë„ë‹¹ ì˜ìƒ: <strong>${report.videosPerChannel}ê°œ</strong></li>\n                    <li style=\"padding: 5px 0;\">ì˜ìƒë‹¹ í›„ë³´: <strong>${report.candidatesPerVideo}ê°œ</strong></li>\n                </ul>\n            </div>\n            \n            <div>\n                <h4 style=\"color: #555; margin-bottom: 10px;\">ğŸ’° ìˆ˜ìµí™”</h4>\n                <ul style=\"list-style: none; padding: 0; margin: 0;\">\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">ìˆ˜ìµí™” ê°€ëŠ¥: <strong>${report.monetizableCandidates}ê°œ</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">ì¿ íŒ¡ ì œí’ˆ: <strong>${report.coupangProductsFound}ê°œ</strong></li>\n                    <li style=\"padding: 5px 0;\">ìˆ˜ìµí™” ë¹„ìœ¨: <strong>${report.monetizationRate}%</strong></li>\n                </ul>\n            </div>\n            \n            <div>\n                <h4 style=\"color: #555; margin-bottom: 10px;\">ğŸ”§ ì‹œìŠ¤í…œ</h4>\n                <ul style=\"list-style: none; padding: 0; margin: 0;\">\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">ì´ ì—ëŸ¬: <strong>${report.totalErrors}ê°œ</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">ì‹¬ê°í•œ ì—ëŸ¬: <strong>${report.criticalErrors}ê°œ</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">API í˜¸ì¶œ: <strong>${report.apiCallsCount}íšŒ</strong></li>\n                    <li style=\"padding: 5px 0;\">ì €ì¥ì†Œ ì‚¬ìš©: <strong>${report.storageUsed}GB</strong></li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    \n    <!-- ì•¡ì…˜ ë²„íŠ¼ -->\n    <div style=\"text-align: center; margin-top: 30px;\">\n        <a href=\"${$env.DASHBOARD_BASE_URL}/analytics\" style=\"background: ${gradeColor}; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; display: inline-block; margin: 0 10px;\">ğŸ“Š ëŒ€ì‹œë³´ë“œ ë³´ê¸°</a>\n        <a href=\"${$env.DASHBOARD_BASE_URL}/reports/daily/${report.startDate}\" style=\"background: #1976D2; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; display: inline-block; margin: 0 10px;\">ğŸ“ˆ ìƒì„¸ ë¦¬í¬íŠ¸</a>\n    </div>\n    \n    <!-- Footer -->\n    <div style=\"margin-top: 40px; padding: 20px; background: #f9f9f9; border-radius: 8px; text-align: center; font-size: 12px; color: #666;\">\n        <p style=\"margin: 0;\">ì´ ë¦¬í¬íŠ¸ëŠ” Influence Item Analysis Systemì—ì„œ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>\n        <p style=\"margin: 5px 0 0 0;\">ìƒì„± ì‹œê°„: ${new Date(report.reportGenerated).toLocaleString('ko-KR')}</p>\n    </div>\n</body>\n</html>\n`;\n\n// ì´ë©”ì¼ ë°ì´í„° êµ¬ì„±\nconst emailData = {\n  to: $env.ADMIN_EMAIL,\n  subject: `ğŸ“Š [${report.performanceGrade}] ì¼ì¼ ìš´ì˜ ë¦¬í¬íŠ¸ - ${report.startDate} (${report.isHealthy ? 'ì •ìƒ' : 'ì£¼ì˜í•„ìš”'})`,\n  html: htmlTemplate,\n  priority: report.needsAttention ? 'high' : 'normal'\n};\n\nreturn [{ json: emailData }];"
      },
      "id": "format-email-report",
      "name": "Format Email Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1100,
        400
      ]
    },
    {
      "parameters": {
        "fromEmail": "{{ $env.SMTP_FROM_EMAIL }}",
        "toEmail": "={{ $json.to }}",
        "subject": "={{ $json.subject }}",
        "emailFormat": "html",
        "html": "={{ $json.html }}",
        "options": {
          "priority": "={{ $json.priority }}"
        }
      },
      "id": "send-email-report",
      "name": "Send Email Report",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [
        1300,
        400
      ],
      "credentials": {
        "smtp": {
          "id": "smtp-credentials",
          "name": "SMTP Credentials"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// í†µê³„ ìˆ˜ì§‘ ì‹¤íŒ¨ ì²˜ë¦¬\nconst error = $json;\n\nconsole.error('ì¼ì¼ í†µê³„ ìˆ˜ì§‘ ì‹¤íŒ¨:', error);\n\n// ê¸°ë³¸ ì‹¤íŒ¨ ë¦¬í¬íŠ¸ ë°ì´í„° êµ¬ì„±\nconst failureReport = {\n  reportDate: new Date().toISOString().split('T')[0],\n  error: error.message || 'í†µê³„ ìˆ˜ì§‘ ì‹¤íŒ¨',\n  timestamp: new Date().toISOString()\n};\n\nreturn [{ json: failureReport }];"
      },
      "id": "handle-stats-error",
      "name": "Handle Stats Collection Error",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        700,
        500
      ]
    },
    {
      "parameters": {
        "channel": "{{ $env.SLACK_CHANNEL }}",
        "text": "âŒ ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„± ì‹¤íŒ¨\\n\\nğŸ’¥ ì—ëŸ¬: {{ $json.error }}\\nğŸ“… ë‚ ì§œ: {{ $json.reportDate }}\\nâ° ì‹œê°„: {{ $json.timestamp }}\\n\\nğŸ”§ ì‹œìŠ¤í…œ ê´€ë¦¬ì í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.",
        "otherOptions": {}
      },
      "id": "notify-report-failure",
      "name": "Notify Report Generation Failure",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [
        900,
        500
      ]
    }
  ],
  "connections": {
    "Daily 9PM Report Trigger": {
      "main": [
        [
          {
            "node": "Initialize Report Period",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Initialize Report Period": {
      "main": [
        [
          {
            "node": "Fetch Daily Statistics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Daily Statistics": {
      "main": [
        [
          {
            "node": "Process Daily Statistics",
            "type": "main",
            "index": 0
          }
        ]
      ],
      "error": [
        [
          {
            "node": "Handle Stats Collection Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Daily Statistics": {
      "main": [
        [
          {
            "node": "Format Slack Report",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format Email Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Slack Report": {
      "main": [
        [
          {
            "node": "Send Slack Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Email Report": {
      "main": [
        [
          {
            "node": "Send Email Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handle Stats Collection Error": {
      "main": [
        [
          {
            "node": "Notify Report Generation Failure",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-23T21:54:00.000Z",
  "updatedAt": "2025-06-23T21:54:00.000Z",
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": {
      "id": "error-workflow"
    }
  },
  "staticData": {},
  "active": true
}