{
  "name": "Daily Operations Report Workflow",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "cronExpression": "0 21 * * *"
            }
          ]
        }
      },
      "id": "daily-report-trigger",
      "name": "Daily 9PM Report Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        300,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// 일일 리포트 데이터 수집 시작\nconst reportDate = new Date();\nconst yesterday = new Date(reportDate - 24 * 60 * 60 * 1000);\n\n// 리포트 기간 설정\nconst reportPeriod = {\n  startDate: yesterday.toISOString().split('T')[0],\n  endDate: reportDate.toISOString().split('T')[0],\n  reportGenerated: reportDate.toISOString()\n};\n\nconsole.log(`일일 운영 리포트 생성 시작: ${reportPeriod.startDate}`);\n\nreturn [{ json: reportPeriod }];"
      },
      "id": "init-report-period",
      "name": "Initialize Report Period",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        500,
        300
      ]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "{{ $env.PYTHON_ANALYSIS_ENDPOINT }}/stats/daily",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "start_date",
              "value": "={{ $json.startDate }}"
            },
            {
              "name": "end_date",
              "value": "={{ $json.endDate }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{ $env.ANALYSIS_API_KEY }}"
            }
          ]
        },
        "options": {
          "timeout": 30000
        }
      },
      "id": "fetch-daily-stats",
      "name": "Fetch Daily Statistics",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        700,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// 일일 통계 데이터 처리 및 리포트 구성\nconst reportPeriod = $('Initialize Report Period').item.json;\nconst statsData = $json;\n\n// 통계 데이터 파싱\nconst stats = {\n  // 영상 분석 통계\n  totalVideosAnalyzed: statsData.total_videos_analyzed || 0,\n  totalCandidatesFound: statsData.total_candidates_found || 0,\n  totalApprovedCandidates: statsData.total_approved_candidates || 0,\n  totalRejectedCandidates: statsData.total_rejected_candidates || 0,\n  \n  // 채널 통계\n  activeChannels: statsData.active_channels || 0,\n  newChannelsAdded: statsData.new_channels_added || 0,\n  \n  // 성능 통계\n  avgProcessingTime: statsData.avg_processing_time_seconds || 0,\n  avgScorePerCandidate: statsData.avg_score_per_candidate || 0,\n  \n  // 에러 통계\n  totalErrors: statsData.total_errors || 0,\n  criticalErrors: statsData.critical_errors || 0,\n  \n  // 수익화 통계\n  monetizableCandidates: statsData.monetizable_candidates || 0,\n  coupangProductsFound: statsData.coupang_products_found || 0,\n  \n  // 시스템 통계\n  systemUptime: statsData.system_uptime_percentage || 0,\n  apiCallsCount: statsData.api_calls_count || 0,\n  storageUsed: statsData.storage_used_gb || 0\n};\n\n// 비율 계산\nconst approvalRate = stats.totalCandidatesFound > 0 ? \n  (stats.totalApprovedCandidates / stats.totalCandidatesFound * 100).toFixed(1) : 0;\n  \nconst monetizationRate = stats.totalApprovedCandidates > 0 ? \n  (stats.monetizableCandidates / stats.totalApprovedCandidates * 100).toFixed(1) : 0;\n  \nconst errorRate = stats.totalVideosAnalyzed > 0 ? \n  (stats.totalErrors / stats.totalVideosAnalyzed * 100).toFixed(2) : 0;\n\n// 성과 등급 계산\nfunction getPerformanceGrade(approvalRate, errorRate, uptime) {\n  if (approvalRate >= 30 && errorRate <= 5 && uptime >= 99) return 'A+';\n  if (approvalRate >= 20 && errorRate <= 10 && uptime >= 95) return 'A';\n  if (approvalRate >= 15 && errorRate <= 15 && uptime >= 90) return 'B+';\n  if (approvalRate >= 10 && errorRate <= 20 && uptime >= 85) return 'B';\n  return 'C';\n}\n\nconst performanceGrade = getPerformanceGrade(parseFloat(approvalRate), parseFloat(errorRate), stats.systemUptime);\n\n// 일일 리포트 데이터 구성\nconst dailyReport = {\n  ...reportPeriod,\n  ...stats,\n  \n  // 계산된 비율\n  approvalRate: approvalRate,\n  monetizationRate: monetizationRate,\n  errorRate: errorRate,\n  performanceGrade: performanceGrade,\n  \n  // 상태 평가\n  isHealthy: parseFloat(errorRate) <= 10 && stats.systemUptime >= 95,\n  needsAttention: parseFloat(errorRate) > 15 || stats.systemUptime < 90 || stats.criticalErrors > 0,\n  \n  // 추가 메트릭\n  videosPerChannel: stats.activeChannels > 0 ? (stats.totalVideosAnalyzed / stats.activeChannels).toFixed(1) : 0,\n  candidatesPerVideo: stats.totalVideosAnalyzed > 0 ? (stats.totalCandidatesFound / stats.totalVideosAnalyzed).toFixed(1) : 0\n};\n\nconsole.log(`일일 리포트 데이터 처리 완료: 성과 등급 ${performanceGrade}`);\n\nreturn [{ json: dailyReport }];"
      },
      "id": "process-daily-stats",
      "name": "Process Daily Statistics",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        900,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// 일일 리포트 Slack 메시지 구성\nconst report = $json;\n\n// 성과 등급별 이모지\nconst gradeEmojis = {\n  'A+': '🏆', 'A': '🥇', 'B+': '🥈', 'B': '🥉', 'C': '📊'\n};\n\n// 상태별 이모지\nconst statusEmoji = report.isHealthy ? '🟢' : report.needsAttention ? '🔴' : '🟡';\nconst gradeEmoji = gradeEmojis[report.performanceGrade] || '📊';\n\n// 성과 요약 텍스트\nfunction getPerformanceSummary(grade, approvalRate, errorRate) {\n  if (grade === 'A+' || grade === 'A') {\n    return '시스템이 우수하게 작동하고 있습니다! 👏';\n  } else if (grade === 'B+' || grade === 'B') {\n    return '양호한 성과를 보이고 있습니다. 일부 개선 여지가 있습니다.';\n  } else {\n    return '시스템 성능 개선이 필요합니다. 검토가 필요합니다.';\n  }\n}\n\nconst performanceSummary = getPerformanceSummary(report.performanceGrade, report.approvalRate, report.errorRate);\n\n// 주요 지표 분석\nlet keyInsights = [];\nif (parseFloat(report.approvalRate) > 25) {\n  keyInsights.push('✨ 높은 승인률 달성!');\n}\nif (parseFloat(report.monetizationRate) > 80) {\n  keyInsights.push('💰 우수한 수익화 비율!');\n}\nif (parseFloat(report.errorRate) < 5) {\n  keyInsights.push('🛡️ 안정적인 시스템 운영!');\n}\nif (report.totalVideosAnalyzed > 20) {\n  keyInsights.push('🚀 높은 처리량 달성!');\n}\nif (keyInsights.length === 0) {\n  keyInsights.push('📈 지속적인 개선 노력이 필요합니다.');\n}\n\n// Slack 메시지 구성\nconst slackMessage = {\n  channel: $env.SLACK_CHANNEL,\n  blocks: [\n    {\n      \"type\": \"header\",\n      \"text\": {\n        \"type\": \"plain_text\",\n        \"text\": `${gradeEmoji} 일일 운영 리포트 (${report.startDate})`\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": `${statusEmoji} *시스템 상태:* ${report.isHealthy ? '정상' : report.needsAttention ? '주의 필요' : '보통'}\\n${gradeEmoji} *성과 등급:* ${report.performanceGrade}\\n\\n${performanceSummary}`\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"fields\": [\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*📹 분석된 영상*\\n${report.totalVideosAnalyzed}개`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*🎯 발견된 후보*\\n${report.totalCandidatesFound}개`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*✅ 승인률*\\n${report.approvalRate}%`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*💰 수익화 비율*\\n${report.monetizationRate}%`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*📺 활성 채널*\\n${report.activeChannels}개`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*⚡ 평균 처리 시간*\\n${report.avgProcessingTime}초`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*🛡️ 시스템 가동률*\\n${report.systemUptime}%`\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": `*❌ 오류율*\\n${report.errorRate}%`\n        }\n      ]\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": `*🔍 주요 인사이트:*\\n${keyInsights.join('\\n')}`\n      }\n    }\n  ],\n  attachments: [\n    {\n      \"color\": report.isHealthy ? \"good\" : report.needsAttention ? \"danger\" : \"warning\",\n      \"fields\": [\n        {\n          \"title\": \"세부 메트릭\",\n          \"value\": `승인된 후보: ${report.totalApprovedCandidates}개\\n거절된 후보: ${report.totalRejectedCandidates}개\\n채널당 영상: ${report.videosPerChannel}개\\n영상당 후보: ${report.candidatesPerVideo}개\\n총 에러: ${report.totalErrors}개 (심각: ${report.criticalErrors}개)\\nAPI 호출: ${report.apiCallsCount}회\\n저장소 사용: ${report.storageUsed}GB`,\n          \"short\": false\n        }\n      ],\n      \"actions\": [\n        {\n          \"type\": \"button\",\n          \"text\": \"📊 대시보드 보기\",\n          \"url\": `${$env.DASHBOARD_BASE_URL}/analytics`\n        },\n        {\n          \"type\": \"button\",\n          \"text\": \"📈 상세 통계\",\n          \"url\": `${$env.DASHBOARD_BASE_URL}/reports/daily/${report.startDate}`\n        }\n      ]\n    }\n  ]\n};\n\nreturn [{ json: slackMessage }];"
      },
      "id": "format-slack-report",
      "name": "Format Slack Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1100,
        200
      ]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "channel": "={{ $json.channel }}",
        "blocksUi": "={{ JSON.stringify($json.blocks) }}",
        "attachments": "={{ JSON.stringify($json.attachments) }}",
        "otherOptions": {}
      },
      "id": "send-slack-report",
      "name": "Send Slack Report",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [
        1300,
        200
      ]
    },
    {
      "parameters": {
        "jsCode": "// 상세 이메일 리포트 HTML 템플릿 생성\nconst report = $('Process Daily Statistics').item.json;\n\n// 성과 등급별 색상\nconst gradeColors = {\n  'A+': '#2E7D32', 'A': '#388E3C', 'B+': '#FBC02D', 'B': '#FF8F00', 'C': '#D32F2F'\n};\n\nconst gradeColor = gradeColors[report.performanceGrade] || '#757575';\n\n// 차트 데이터 (간단한 텍스트 기반)\nconst createProgressBar = (value, max, color) => {\n  const percentage = Math.min((value / max) * 100, 100);\n  return `\n    <div style=\"background: #f0f0f0; height: 20px; border-radius: 10px; overflow: hidden; margin: 5px 0;\">\n      <div style=\"background: ${color}; height: 100%; width: ${percentage}%; transition: width 0.3s ease;\"></div>\n    </div>\n    <small style=\"color: #666;\">${value}${max ? ` / ${max}` : ''} (${percentage.toFixed(1)}%)</small>\n  `;\n};\n\n// HTML 이메일 템플릿\nconst htmlTemplate = `\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Daily Operations Report - ${report.startDate}</title>\n</head>\n<body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f5f5f5;\">\n    <!-- Header -->\n    <div style=\"background: linear-gradient(135deg, ${gradeColor}, #1976D2); color: white; padding: 30px; border-radius: 8px; text-align: center; margin-bottom: 20px;\">\n        <h1 style=\"margin: 0; font-size: 28px;\">📊 일일 운영 리포트</h1>\n        <p style=\"margin: 10px 0 0 0; font-size: 16px; opacity: 0.9;\">${report.startDate} 분석 결과</p>\n        <div style=\"background: rgba(255,255,255,0.2); display: inline-block; padding: 10px 20px; border-radius: 20px; margin-top: 15px;\">\n            <span style=\"font-size: 24px; font-weight: bold;\">성과 등급: ${report.performanceGrade}</span>\n        </div>\n    </div>\n    \n    <!-- 시스템 상태 요약 -->\n    <div style=\"background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">\n        <h2 style=\"color: #333; margin-top: 0; border-bottom: 2px solid ${gradeColor}; padding-bottom: 10px;\">🚦 시스템 상태 요약</h2>\n        \n        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;\">\n            <div style=\"text-align: center; padding: 15px; background: ${report.isHealthy ? '#E8F5E8' : '#FFF3E0'}; border-radius: 8px;\">\n                <div style=\"font-size: 24px; margin-bottom: 5px;\">${report.isHealthy ? '🟢' : '🟡'}</div>\n                <div style=\"font-weight: bold; color: ${report.isHealthy ? '#2E7D32' : '#FF8F00'};\">시스템 상태</div>\n                <div>${report.isHealthy ? '정상 운영' : '주의 필요'}</div>\n            </div>\n            <div style=\"text-align: center; padding: 15px; background: #F3E5F5; border-radius: 8px;\">\n                <div style=\"font-size: 24px; margin-bottom: 5px;\">⚡</div>\n                <div style=\"font-weight: bold; color: #7B1FA2;\">가동률</div>\n                <div>${report.systemUptime}%</div>\n            </div>\n            <div style=\"text-align: center; padding: 15px; background: #E3F2FD; border-radius: 8px;\">\n                <div style=\"font-size: 24px; margin-bottom: 5px;\">📊</div>\n                <div style=\"font-weight: bold; color: #1976D2;\">처리량</div>\n                <div>${report.totalVideosAnalyzed}개 영상</div>\n            </div>\n            <div style=\"text-align: center; padding: 15px; background: #E8F5E8; border-radius: 8px;\">\n                <div style=\"font-size: 24px; margin-bottom: 5px;\">✅</div>\n                <div style=\"font-weight: bold; color: #2E7D32;\">승인률</div>\n                <div>${report.approvalRate}%</div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- 주요 메트릭 -->\n    <div style=\"background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">\n        <h2 style=\"color: #333; margin-top: 0; border-bottom: 2px solid ${gradeColor}; padding-bottom: 10px;\">📈 주요 성과 지표</h2>\n        \n        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;\">\n            <div>\n                <h3 style=\"color: #555; margin-bottom: 15px;\">🎯 분석 성과</h3>\n                \n                <div style=\"margin-bottom: 20px;\">\n                    <strong>승인률</strong>\n                    ${createProgressBar(parseFloat(report.approvalRate), 100, '#4CAF50')}\n                </div>\n                \n                <div style=\"margin-bottom: 20px;\">\n                    <strong>수익화 비율</strong>\n                    ${createProgressBar(parseFloat(report.monetizationRate), 100, '#FF9800')}\n                </div>\n                \n                <div style=\"margin-bottom: 20px;\">\n                    <strong>평균 점수</strong>\n                    ${createProgressBar(report.avgScorePerCandidate, 100, '#2196F3')}\n                </div>\n            </div>\n            \n            <div>\n                <h3 style=\"color: #555; margin-bottom: 15px;\">🛡️ 시스템 안정성</h3>\n                \n                <div style=\"margin-bottom: 20px;\">\n                    <strong>가동률</strong>\n                    ${createProgressBar(report.systemUptime, 100, '#9C27B0')}\n                </div>\n                \n                <div style=\"margin-bottom: 20px;\">\n                    <strong>오류율 (낮을수록 좋음)</strong>\n                    ${createProgressBar(parseFloat(report.errorRate), 20, report.errorRate <= 5 ? '#4CAF50' : report.errorRate <= 10 ? '#FF9800' : '#F44336')}\n                </div>\n                \n                <div style=\"margin-bottom: 20px;\">\n                    <strong>평균 처리 시간</strong>\n                    <div style=\"color: #666; margin-top: 5px;\">${report.avgProcessingTime}초</div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- 상세 통계 -->\n    <div style=\"background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);\">\n        <h2 style=\"color: #333; margin-top: 0; border-bottom: 2px solid ${gradeColor}; padding-bottom: 10px;\">📊 상세 통계</h2>\n        \n        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;\">\n            <div>\n                <h4 style=\"color: #555; margin-bottom: 10px;\">📹 영상 분석</h4>\n                <ul style=\"list-style: none; padding: 0; margin: 0;\">\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">총 분석 영상: <strong>${report.totalVideosAnalyzed}개</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">발견된 후보: <strong>${report.totalCandidatesFound}개</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">승인된 후보: <strong>${report.totalApprovedCandidates}개</strong></li>\n                    <li style=\"padding: 5px 0;\">거절된 후보: <strong>${report.totalRejectedCandidates}개</strong></li>\n                </ul>\n            </div>\n            \n            <div>\n                <h4 style=\"color: #555; margin-bottom: 10px;\">📺 채널 현황</h4>\n                <ul style=\"list-style: none; padding: 0; margin: 0;\">\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">활성 채널: <strong>${report.activeChannels}개</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">신규 채널: <strong>${report.newChannelsAdded}개</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">채널당 영상: <strong>${report.videosPerChannel}개</strong></li>\n                    <li style=\"padding: 5px 0;\">영상당 후보: <strong>${report.candidatesPerVideo}개</strong></li>\n                </ul>\n            </div>\n            \n            <div>\n                <h4 style=\"color: #555; margin-bottom: 10px;\">💰 수익화</h4>\n                <ul style=\"list-style: none; padding: 0; margin: 0;\">\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">수익화 가능: <strong>${report.monetizableCandidates}개</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">쿠팡 제품: <strong>${report.coupangProductsFound}개</strong></li>\n                    <li style=\"padding: 5px 0;\">수익화 비율: <strong>${report.monetizationRate}%</strong></li>\n                </ul>\n            </div>\n            \n            <div>\n                <h4 style=\"color: #555; margin-bottom: 10px;\">🔧 시스템</h4>\n                <ul style=\"list-style: none; padding: 0; margin: 0;\">\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">총 에러: <strong>${report.totalErrors}개</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">심각한 에러: <strong>${report.criticalErrors}개</strong></li>\n                    <li style=\"padding: 5px 0; border-bottom: 1px solid #eee;\">API 호출: <strong>${report.apiCallsCount}회</strong></li>\n                    <li style=\"padding: 5px 0;\">저장소 사용: <strong>${report.storageUsed}GB</strong></li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    \n    <!-- 액션 버튼 -->\n    <div style=\"text-align: center; margin-top: 30px;\">\n        <a href=\"${$env.DASHBOARD_BASE_URL}/analytics\" style=\"background: ${gradeColor}; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; display: inline-block; margin: 0 10px;\">📊 대시보드 보기</a>\n        <a href=\"${$env.DASHBOARD_BASE_URL}/reports/daily/${report.startDate}\" style=\"background: #1976D2; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; display: inline-block; margin: 0 10px;\">📈 상세 리포트</a>\n    </div>\n    \n    <!-- Footer -->\n    <div style=\"margin-top: 40px; padding: 20px; background: #f9f9f9; border-radius: 8px; text-align: center; font-size: 12px; color: #666;\">\n        <p style=\"margin: 0;\">이 리포트는 Influence Item Analysis System에서 자동 생성되었습니다.</p>\n        <p style=\"margin: 5px 0 0 0;\">생성 시간: ${new Date(report.reportGenerated).toLocaleString('ko-KR')}</p>\n    </div>\n</body>\n</html>\n`;\n\n// 이메일 데이터 구성\nconst emailData = {\n  to: $env.ADMIN_EMAIL,\n  subject: `📊 [${report.performanceGrade}] 일일 운영 리포트 - ${report.startDate} (${report.isHealthy ? '정상' : '주의필요'})`,\n  html: htmlTemplate,\n  priority: report.needsAttention ? 'high' : 'normal'\n};\n\nreturn [{ json: emailData }];"
      },
      "id": "format-email-report",
      "name": "Format Email Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1100,
        400
      ]
    },
    {
      "parameters": {
        "fromEmail": "{{ $env.SMTP_FROM_EMAIL }}",
        "toEmail": "={{ $json.to }}",
        "subject": "={{ $json.subject }}",
        "emailFormat": "html",
        "html": "={{ $json.html }}",
        "options": {
          "priority": "={{ $json.priority }}"
        }
      },
      "id": "send-email-report",
      "name": "Send Email Report",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [
        1300,
        400
      ],
      "credentials": {
        "smtp": {
          "id": "smtp-credentials",
          "name": "SMTP Credentials"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 통계 수집 실패 처리\nconst error = $json;\n\nconsole.error('일일 통계 수집 실패:', error);\n\n// 기본 실패 리포트 데이터 구성\nconst failureReport = {\n  reportDate: new Date().toISOString().split('T')[0],\n  error: error.message || '통계 수집 실패',\n  timestamp: new Date().toISOString()\n};\n\nreturn [{ json: failureReport }];"
      },
      "id": "handle-stats-error",
      "name": "Handle Stats Collection Error",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        700,
        500
      ]
    },
    {
      "parameters": {
        "channel": "{{ $env.SLACK_CHANNEL }}",
        "text": "❌ 일일 리포트 생성 실패\\n\\n💥 에러: {{ $json.error }}\\n📅 날짜: {{ $json.reportDate }}\\n⏰ 시간: {{ $json.timestamp }}\\n\\n🔧 시스템 관리자 확인이 필요합니다.",
        "otherOptions": {}
      },
      "id": "notify-report-failure",
      "name": "Notify Report Generation Failure",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [
        900,
        500
      ]
    }
  ],
  "connections": {
    "Daily 9PM Report Trigger": {
      "main": [
        [
          {
            "node": "Initialize Report Period",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Initialize Report Period": {
      "main": [
        [
          {
            "node": "Fetch Daily Statistics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Daily Statistics": {
      "main": [
        [
          {
            "node": "Process Daily Statistics",
            "type": "main",
            "index": 0
          }
        ]
      ],
      "error": [
        [
          {
            "node": "Handle Stats Collection Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Daily Statistics": {
      "main": [
        [
          {
            "node": "Format Slack Report",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format Email Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Slack Report": {
      "main": [
        [
          {
            "node": "Send Slack Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Email Report": {
      "main": [
        [
          {
            "node": "Send Email Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handle Stats Collection Error": {
      "main": [
        [
          {
            "node": "Notify Report Generation Failure",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-23T21:54:00.000Z",
  "updatedAt": "2025-06-23T21:54:00.000Z",
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": {
      "id": "error-workflow"
    }
  },
  "staticData": {},
  "active": true
}